# Requirements Archive: v1.0 MVP

**Archived:** 2026-01-24
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Loan Document Data Extraction System

**Defined:** 2026-01-23
**Core Value:** Accurate extraction of borrower data with complete traceability - every extracted field must include source attribution showing which document and page it came from.

## v1 Requirements

Requirements for initial release. Each maps to roadmap phases.

### Foundation

- [x] **FOUND-01**: Project structure created with backend, frontend, infrastructure, docs directories
- [x] **FOUND-02**: Backend pyproject.toml with all dependencies and dev tools configured
- [x] **FOUND-03**: Backend config.py with Pydantic Settings for environment variables
- [x] **FOUND-04**: Frontend package.json with Next.js 14+, React 18, TanStack Query, shadcn/ui
- [x] **FOUND-05**: Frontend configuration files (next.config.js, tailwind.config.ts)
- [x] **FOUND-06**: Docker-compose for local PostgreSQL and Redis development
- [x] **FOUND-07**: Git repo initialized with appropriate .gitignore

### Document Ingestion

- [x] **INGEST-01**: Docling processor wraps DocumentConverter for PDF processing
- [x] **INGEST-02**: Docling processor handles DOCX files with layout preservation
- [x] **INGEST-03**: Docling processor handles image files (PNG/JPG) with OCR
- [x] **INGEST-04**: Docling processor extracts tables with structure
- [x] **INGEST-05**: Docling processor returns page-level metadata
- [x] **INGEST-06**: Document service uploads files to Google Cloud Storage
- [x] **INGEST-07**: Document service creates database record with metadata
- [x] **INGEST-08**: Document service queues processing task in Cloud Tasks
- [x] **INGEST-09**: Document service detects duplicates via file hash (SHA-256)
- [x] **INGEST-10**: Document service handles processing errors gracefully
- [x] **INGEST-11**: GCS client uploads files and returns gs:// URI
- [x] **INGEST-12**: GCS client downloads files by URI
- [x] **INGEST-13**: GCS client generates signed URLs for temporary access
- [x] **INGEST-14**: GCS client checks file existence

### LLM Extraction

- [x] **EXTRACT-01**: Gemini client initializes with google-genai SDK
- [x] **EXTRACT-02**: Gemini client supports gemini-3-flash-preview model
- [x] **EXTRACT-03**: Gemini client supports gemini-3-pro-preview model
- [x] **EXTRACT-04**: Gemini client implements retry with exponential backoff (max 3 attempts)
- [x] **EXTRACT-05**: Gemini client handles rate limiting (429) with 60s wait
- [x] **EXTRACT-06**: Gemini client handles server errors (5xx) with 10s wait
- [x] **EXTRACT-07**: Gemini client handles timeout with chunk size reduction
- [x] **EXTRACT-08**: Gemini client handles None response when max_output_tokens exceeded
- [x] **EXTRACT-09**: Gemini client tracks token usage (input/output)
- [x] **EXTRACT-10**: Gemini client returns structured response with latency metrics
- [x] **EXTRACT-11**: Complexity classifier identifies simple single-borrower documents
- [x] **EXTRACT-12**: Complexity classifier identifies complex multi-borrower documents
- [x] **EXTRACT-13**: Complexity classifier identifies poor scan quality documents
- [x] **EXTRACT-14**: Complexity classifier identifies handwritten sections
- [x] **EXTRACT-15**: Complexity classifier returns STANDARD or COMPLEX level
- [x] **EXTRACT-16**: Extraction prompts render with document text
- [x] **EXTRACT-17**: Extraction prompts include Pydantic schema for structured output
- [x] **EXTRACT-18**: Extraction prompts handle special characters safely
- [x] **EXTRACT-19**: Extractor assesses document complexity before extraction
- [x] **EXTRACT-20**: Extractor chunks large documents (4000 tokens, 200 overlap)
- [x] **EXTRACT-21**: Extractor calls appropriate model (Flash for standard, Pro for complex)
- [x] **EXTRACT-22**: Extractor aggregates results from multiple chunks
- [x] **EXTRACT-23**: Extractor deduplicates borrower records (SSN/account match, fuzzy name match)
- [x] **EXTRACT-24**: Extractor tracks source attribution (document ID, page, section, snippet)
- [x] **EXTRACT-25**: Extractor calculates confidence scores (0.0-1.0 range)
- [x] **EXTRACT-26**: Confidence score increases for complete required fields
- [x] **EXTRACT-27**: Confidence score increases for complete optional fields
- [x] **EXTRACT-28**: Confidence score increases for multi-source confirmation
- [x] **EXTRACT-29**: Confidence score increases for format validation passing

### Data Validation

- [x] **VALID-01**: Validator checks SSN format (XXX-XX-XXXX)
- [x] **VALID-02**: Validator checks phone number format (various US formats)
- [x] **VALID-03**: Validator checks zip code format (XXXXX or XXXXX-XXXX)
- [x] **VALID-04**: Validator checks date formats
- [x] **VALID-05**: Validator flags records with confidence < 0.7 for manual review
- [x] **VALID-06**: Validator tracks validation errors with reasons
- [x] **VALID-07**: Validator checks borrower data consistency across documents
- [x] **VALID-08**: Validator validates income progression is logical
- [x] **VALID-09**: Validator flags conflicting addresses for same borrower

### Data Models

- [x] **MODEL-01**: BorrowerRecord Pydantic model with all fields
- [x] **MODEL-02**: Address Pydantic model with structured fields
- [x] **MODEL-03**: IncomeRecord Pydantic model with amount, period, year, source type
- [x] **MODEL-04**: SourceReference Pydantic model with document ID, page, section, snippet
- [x] **MODEL-05**: BorrowerRecord includes confidence score field
- [x] **MODEL-06**: BorrowerRecord includes extracted_at timestamp
- [x] **MODEL-07**: All models support JSON serialization

### Database Storage

- [x] **DB-01**: Document SQLAlchemy model with id, filename, file_hash, gcs_uri, status
- [x] **DB-02**: Document model includes created_at and processed_at timestamps
- [x] **DB-03**: Borrower SQLAlchemy model with id, name, address_json, confidence_score
- [x] **DB-04**: IncomeRecord SQLAlchemy model with borrower foreign key
- [x] **DB-05**: AccountNumber SQLAlchemy model with borrower foreign key and type
- [x] **DB-06**: SourceReference SQLAlchemy model with borrower and document foreign keys
- [x] **DB-07**: SourceReference includes page, section, snippet fields
- [x] **DB-08**: DocumentRepository creates document records
- [x] **DB-09**: DocumentRepository retrieves documents by ID
- [x] **DB-10**: DocumentRepository retrieves documents by file hash
- [x] **DB-11**: DocumentRepository updates document status
- [x] **DB-12**: DocumentRepository lists documents with pagination
- [x] **DB-13**: BorrowerRepository creates borrower records with related entities
- [x] **DB-14**: BorrowerRepository retrieves borrowers by ID with relationships
- [x] **DB-15**: BorrowerRepository searches borrowers by name
- [x] **DB-16**: BorrowerRepository searches borrowers by account number
- [x] **DB-17**: BorrowerRepository lists borrowers with pagination
- [x] **DB-18**: Repositories handle transactions with automatic rollback on error
- [x] **DB-19**: Alembic migrations configured for async PostgreSQL
- [x] **DB-20**: Initial migration creates all tables

### REST API

- [x] **API-01**: FastAPI application configured with CORS middleware
- [x] **API-02**: FastAPI exception handlers for custom errors
- [x] **API-03**: OpenAPI documentation auto-generated and accessible
- [x] **API-04**: Health check endpoint returns service status
- [x] **API-05**: Lifespan manager handles database connection pool
- [x] **API-06**: Dependency injection provides database session
- [x] **API-07**: Dependency injection provides DocumentService instance
- [x] **API-08**: Dependency injection provides BorrowerRepository instance
- [x] **API-09**: POST /api/documents endpoint accepts file upload
- [x] **API-10**: POST /api/documents returns 201 with document ID
- [x] **API-11**: POST /api/documents validates file type and size
- [x] **API-12**: GET /api/documents/{id} returns document details
- [x] **API-13**: GET /api/documents/{id}/status returns processing status
- [x] **API-14**: GET /api/documents lists documents with pagination
- [x] **API-15**: GET /api/documents returns 404 for non-existent document
- [x] **API-16**: GET /api/borrowers lists borrowers with pagination
- [x] **API-17**: GET /api/borrowers/{id} returns full borrower details
- [x] **API-18**: GET /api/borrowers/{id} includes income history
- [x] **API-19**: GET /api/borrowers/{id} includes account numbers
- [x] **API-20**: GET /api/borrowers/{id} includes source references
- [x] **API-21**: GET /api/borrowers/{id}/sources returns source documents
- [x] **API-22**: GET /api/borrowers/search supports name query
- [x] **API-23**: GET /api/borrowers/search supports account number query
- [x] **API-24**: API returns meaningful HTTP status codes (400, 404, 500)

### Frontend UI

- [x] **UI-01**: Next.js app with app router configured
- [x] **UI-02**: Layout component with navigation header
- [x] **UI-03**: shadcn/ui components installed
- [x] **UI-04**: Tailwind CSS configured with custom theme
- [x] **UI-05**: Type-safe API client using fetch with typed responses
- [x] **UI-06**: API client handles uploadDocument
- [x] **UI-07**: API client handles getDocumentStatus
- [x] **UI-08**: API client handles listBorrowers with pagination
- [x] **UI-09**: API client handles getBorrower
- [x] **UI-10**: API client handles searchBorrowers
- [x] **UI-11**: Document upload page at /documents with drag-and-drop
- [x] **UI-12**: Document upload shows progress indicator
- [x] **UI-13**: Document list shows status badges
- [x] **UI-14**: Document list is clickable to view details
- [x] **UI-15**: Document detail page at /documents/[id]
- [x] **UI-16**: Upload zone component handles file selection
- [x] **UI-17**: Document table component displays list with sorting
- [x] **UI-18**: Status badge component shows appropriate colors
- [x] **UI-19**: Borrower list page at /borrowers with search
- [x] **UI-20**: Borrower list supports pagination
- [x] **UI-21**: Borrower detail page at /borrowers/[id]
- [x] **UI-22**: Borrower card component displays summary
- [x] **UI-23**: Income timeline component visualizes income history
- [x] **UI-24**: Source references component links to documents
- [x] **UI-25**: Search bar component filters borrowers
- [x] **UI-26**: Architecture overview page at /architecture
- [x] **UI-27**: Design decisions page at /architecture/decisions
- [x] **UI-28**: Data pipeline page at /architecture/pipeline with flow diagram
- [x] **UI-29**: Scaling strategy page at /architecture/scaling
- [x] **UI-30**: System diagram component shows architecture
- [x] **UI-31**: Pipeline flow component shows processing steps
- [x] **UI-32**: Decision card component displays ADRs
- [x] **UI-33**: Scaling chart component shows performance projections
- [x] **UI-34**: Dashboard home page at / with summary stats
- [x] **UI-35**: Sidebar navigation component
- [x] **UI-36**: Header component with branding
- [x] **UI-37**: All pages responsive for desktop and tablet

### GCP Infrastructure

- [x] **INFRA-01**: Terraform main.tf with provider configuration
- [x] **INFRA-02**: Terraform variables.tf with project_id, region, etc.
- [x] **INFRA-03**: Cloud SQL PostgreSQL instance configured
- [x] **INFRA-04**: Cloud SQL includes automated backups
- [x] **INFRA-05**: Cloud SQL connection for Cloud Run configured
- [x] **INFRA-06**: Cloud Storage bucket for documents created
- [x] **INFRA-07**: Cloud Storage bucket has lifecycle policies
- [x] **INFRA-08**: Cloud Storage bucket has IAM permissions
- [x] **INFRA-09**: Cloud Run service for backend configured
- [x] **INFRA-10**: Cloud Run backend has environment variables
- [x] **INFRA-11**: Cloud Run backend has auto-scaling configured
- [x] **INFRA-12**: Cloud Run backend has Cloud SQL connection
- [x] **INFRA-13**: Cloud Run service for frontend configured
- [x] **INFRA-14**: Cloud Run frontend has backend API URL
- [x] **INFRA-15**: Cloud Tasks queue for document processing
- [x] **INFRA-16**: Cloud Tasks queue has appropriate rate limits
- [x] **INFRA-17**: IAM service account for backend created
- [x] **INFRA-18**: IAM roles assigned following least-privilege
- [x] **INFRA-19**: IAM allows backend to access GCS and Cloud SQL
- [x] **INFRA-20**: Terraform outputs include service URLs
- [x] **INFRA-21**: Terraform outputs include database connection string
- [x] **INFRA-22**: Setup script (setup-gcp.sh) provisions GCP project
- [x] **INFRA-23**: Deploy script (deploy.sh) automates deployment
- [x] **INFRA-24**: Backend Dockerfile with multi-stage build
- [x] **INFRA-25**: Backend Dockerfile optimized for Cloud Run
- [x] **INFRA-26**: Frontend Dockerfile with multi-stage build
- [x] **INFRA-27**: Frontend Dockerfile uses Next.js standalone output

### Documentation

- [x] **DOCS-01**: SYSTEM_DESIGN.md includes architecture overview
- [x] **DOCS-02**: SYSTEM_DESIGN.md includes component diagram (Mermaid)
- [x] **DOCS-03**: SYSTEM_DESIGN.md describes data flow
- [x] **DOCS-04**: SYSTEM_DESIGN.md documents technology stack
- [x] **DOCS-05**: SYSTEM_DESIGN.md includes pipeline flowchart (Mermaid)
- [x] **DOCS-06**: SYSTEM_DESIGN.md describes ingestion with Docling
- [x] **DOCS-07**: SYSTEM_DESIGN.md describes LLM extraction with Gemini
- [x] **DOCS-08**: SYSTEM_DESIGN.md describes validation layer
- [x] **DOCS-09**: SYSTEM_DESIGN.md describes storage in PostgreSQL
- [x] **DOCS-10**: SYSTEM_DESIGN.md describes API retrieval
- [x] **DOCS-11**: SYSTEM_DESIGN.md documents AI/LLM integration strategy
- [x] **DOCS-12**: SYSTEM_DESIGN.md explains model selection rationale
- [x] **DOCS-13**: SYSTEM_DESIGN.md explains dynamic model selection
- [x] **DOCS-14**: SYSTEM_DESIGN.md documents prompt engineering approach
- [x] **DOCS-15**: SYSTEM_DESIGN.md documents chunking strategy
- [x] **DOCS-16**: SYSTEM_DESIGN.md documents confidence scoring formula
- [x] **DOCS-17**: SYSTEM_DESIGN.md documents error recovery strategy
- [x] **DOCS-18**: SYSTEM_DESIGN.md includes cost analysis (Flash vs Pro)
- [x] **DOCS-19**: SYSTEM_DESIGN.md includes scaling projections (10x, 100x)
- [x] **DOCS-20**: ARCHITECTURE_DECISIONS.md includes ADR-001 (Docling)
- [x] **DOCS-21**: ARCHITECTURE_DECISIONS.md includes ADR-002 (Gemini)
- [x] **DOCS-22**: ARCHITECTURE_DECISIONS.md includes ADR-003 (PostgreSQL)
- [x] **DOCS-23**: ARCHITECTURE_DECISIONS.md includes ADR-004 (Cloud Run)
- [x] **DOCS-24**: ARCHITECTURE_DECISIONS.md includes ADR-005 (Next.js)
- [x] **DOCS-25**: README.md includes setup instructions
- [x] **DOCS-26**: README.md includes run instructions (local and GCP)
- [x] **DOCS-27**: README.md includes architecture summary
- [x] **DOCS-28**: README.md includes API usage examples

### Testing & Quality

- [x] **TEST-01**: Docling processor unit tests cover all file types
- [x] **TEST-02**: Document service unit tests mock GCS and Docling
- [x] **TEST-03**: GCS client unit tests mock Google Cloud Storage
- [x] **TEST-04**: Ingestion integration tests cover full pipeline
- [x] **TEST-05**: LLM client unit tests mock Gemini API
- [x] **TEST-06**: Complexity classifier unit tests cover edge cases
- [x] **TEST-07**: Extractor unit tests cover chunking and deduplication
- [x] **TEST-08**: Validation unit tests cover all format checks
- [x] **TEST-09**: Extraction integration tests use Flash and Pro models
- [x] **TEST-10**: Database models unit tests cover relationships
- [x] **TEST-11**: Repository unit tests mock database
- [x] **TEST-12**: Document routes unit tests cover all endpoints
- [x] **TEST-13**: Borrower routes unit tests cover search functionality
- [x] **TEST-14**: E2E API tests cover upload-to-query flow
- [x] **TEST-15**: Sample loan documents integration test with real corpus
- [x] **TEST-16**: Frontend smoke tests cover critical paths
- [x] **TEST-17**: pytest coverage report shows >80% backend coverage (92% achieved)
- [x] **TEST-18**: mypy strict mode passes with zero errors
- [x] **TEST-19**: Frontend builds successfully with npm run build
- [x] **TEST-20**: Terraform validates successfully

---

## Milestone Summary

**Shipped:** 222 of 222 v1 requirements (100%)

**Adjusted:** None - all requirements implemented as defined

**Dropped:** None - all requirements satisfied

**Key Achievements:**
- Complete full-stack AI pipeline (Docling → Gemini → PostgreSQL → Next.js)
- Production infrastructure (32 Terraform resources on GCP)
- Enterprise quality (92% test coverage, mypy strict, 283 passing tests)
- Gap closure (Phase 8 wired extraction pipeline, Phase 9 added async processing)
- All E2E flows working (upload → extraction → persistence → retrieval)

---
*Archived: 2026-01-24 as part of v1.0 milestone completion*
