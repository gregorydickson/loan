# Milestone v2.1: Production Deployment & Verification

**Status:** âœ… SHIPPED 2026-01-26
**Phases:** 19-21
**Total Plans:** 11

## Overview

Deploy all services to GCP production and verify functionality through comprehensive Chrome-based testing. This milestone ensures the system is fully operational in production with all extraction methods, GPU OCR integration, and UI features working correctly.

## Phases

### Phase 19: Production Deployment Verification

**Goal**: All services running and accessible in GCP production environment
**Depends on**: Phase 18 (v2.0 complete)
**Plans**: 4 plans

Plans:

- [x] 19-01: Check deployments and deploy backend
- [x] 19-02: Deploy frontend with backend URL
- [x] 19-03: Deploy GPU service with L4 GPU
- [x] 19-04: Verify secrets and comprehensive health check

**Details:**

Created complete GCP infrastructure including VPC (memorygraph-prod-vpc), service account (loan-cloud-run), Artifact Registry repository (loan-repo), and deployed all three services. Backend deployed with Cloud SQL connection via VPC egress, secrets mounted (database-url, gemini-api-key), and health endpoint responding. Frontend deployed with backend URL baked in via CloudBuild substitution. GPU service verified with L4 GPU and scale-to-zero configuration.

**Key Decisions:**
- Used memorygraph-prod GCP project for deployment (user decision)
- Created loan-specific Artifact Registry repository to avoid conflicts
- Created dedicated VPC with cloud-run-subnet for Cloud Run egress

### Phase 20: Core Extraction Verification

**Goal**: End-to-end document extraction flows work correctly in production
**Depends on**: Phase 19
**Plans**: 4 plans (3 original + 1 gap closure)

Plans:

- [x] 20-01: Configure database and Gemini API key prerequisites
- [x] 20-02: Verify frontend loads and document upload (TEST-01, TEST-02)
- [x] 20-03: Verify extraction methods and GPU OCR (TEST-03, TEST-04, TEST-05 partial)
- [x] 20-04: Wire GPU OCR integration (gap closure for TEST-05)

**Details:**

Created loan_extraction database on Cloud SQL with schema migrations, updated production secrets with real credentials. Verified frontend loads and document upload flow works end-to-end. Tested both Docling and LangExtract extraction methods in production with successful borrower data extraction. Wired GPU OCR integration in ocr_router.py with _merge_gpu_ocr_results() method to combine GPU-processed scanned pages with native text pages.

**Key Decisions:**
- Created new loan_extraction database (option-a) instead of reusing existing database
- Used postgres user with password auth for database connectivity
- Pre-download Docling models during Docker build (not at runtime) for Cloud Run reliability
- Increased Cloud Run memory to 4Gi for Docling processing requirements

### Phase 21: UI Feature Verification

**Goal**: All frontend features display extraction results correctly
**Depends on**: Phase 20
**Plans**: 3 plans (2 original + 1 gap closure)

Plans:

- [x] 21-01: Expose char_start/char_end in API and implement UI highlighting
- [x] 21-02: Comprehensive UI verification (TEST-06, TEST-07, TEST-08, TEST-09)
- [x] 21-03: Fix dashboard badge colors (gap closure for TEST-08)

**Details:**

Added char_start/char_end fields to SourceReferenceResponse Pydantic model and SourceReference TypeScript interface. Implemented "Exact Match" badge indicator in SourceReferences component when character offsets are present (LangExtract extractions). Verified source attribution UI, character offset display, borrower dashboard data, and extraction visualizations all working correctly. Fixed dashboard confidence badge colors by adding success/warning badge variants to use semantic colors (green/yellow/red) instead of monochrome theme colors.

**Key Decisions:**
- Badge indicator vs text highlighting - chose badge for simplicity (char offsets are document-level, not snippet-level)
- Semantic badge colors (success/warning/destructive) implemented for visual confidence differentiation

---

## Milestone Summary

**Requirements Coverage:**
- DEPLOY-01 through DEPLOY-06: All deployment requirements satisfied
- TEST-01 through TEST-09: All verification tests passed (8 PASS, 1 PARTIAL acceptable)

**Key Decisions:**
- Production deployment to memorygraph-prod project with loan-specific infrastructure
- New loan_extraction database for clean schema separation
- Pre-download Docling models in Docker build for reliability
- GPU OCR integration wired with hybrid document support (GPU for scanned, Docling for native)
- Character-level offset badge indicator for LangExtract visual differentiation
- Semantic badge color variants for confidence score clarity

**Issues Resolved:**
- Backend Dockerfile missing examples directory and incorrect module path (c6adffb9, 4b5af626)
- Multiple CloudBuild deployment failures due to missing GCP infrastructure (auto-created)
- DocumentStatus enum mapping for PostgreSQL (dc6925d0)
- Tesseract OCR dependencies for Docling PDF processing (afa19566)
- RapidOCR model download failures (98873b1b)
- GPU OCR integration not wired (ed59d8cf - gap closure)
- Dashboard badge colors using dark theme instead of semantic colors (f94edc1d, e5ee560b - gap closure)

**Technical Debt Incurred:**
None - all gaps identified during verification were closed within the milestone.

---

_For current project status, see .planning/PROJECT.md_
