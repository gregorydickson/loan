---
phase: 12-langextract-advanced-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/extraction/extraction_config.py
  - backend/src/extraction/langextract_processor.py
  - backend/tests/unit/extraction/test_extraction_config.py
autonomous: true

must_haves:
  truths:
    - "Multi-pass extraction configurable from 2-5 passes"
    - "Parallel processing configurable via max_workers (1-50)"
    - "Invalid configuration values raise ValueError"
  artifacts:
    - path: "backend/src/extraction/extraction_config.py"
      provides: "ExtractionConfig dataclass with validation"
      exports: ["ExtractionConfig"]
    - path: "backend/src/extraction/langextract_processor.py"
      provides: "Enhanced LangExtractProcessor using ExtractionConfig"
      contains: "ExtractionConfig"
    - path: "backend/tests/unit/extraction/test_extraction_config.py"
      provides: "Unit tests for ExtractionConfig validation"
      min_lines: 40
  key_links:
    - from: "backend/src/extraction/langextract_processor.py"
      to: "backend/src/extraction/extraction_config.py"
      via: "import ExtractionConfig"
      pattern: "from.*extraction_config import ExtractionConfig"
    - from: "backend/src/extraction/langextract_processor.py"
      to: "lx.extract()"
      via: "max_workers parameter"
      pattern: "max_workers=config\\.max_workers"
---

<objective>
Create ExtractionConfig dataclass for configurable multi-pass and parallel extraction, and update LangExtractProcessor to use it.

Purpose: LXTR-06 requires configurable extraction passes (2-5), LXTR-10 requires parallel chunk processing via max_workers. The config dataclass encapsulates these settings with validation.

Output: ExtractionConfig dataclass, updated LangExtractProcessor.extract() signature, unit tests for config validation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-langextract-advanced-features/12-RESEARCH.md
@backend/src/extraction/langextract_processor.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExtractionConfig dataclass</name>
  <files>backend/src/extraction/extraction_config.py</files>
  <action>
Create `ExtractionConfig` dataclass with three fields:
- `extraction_passes: int = 2` - Number of extraction passes (validated 2-5)
- `max_workers: int = 10` - Parallel processing workers (validated 1-50)
- `max_char_buffer: int = 1000` - Characters per chunk (validated 500-5000)

Add `__post_init__` validation that raises `ValueError` with descriptive message for out-of-range values.

Include docstring explaining each field's purpose and valid ranges (per 12-RESEARCH.md Pattern 1).

Example validation message: `"extraction_passes must be 2-5, got {value}"`
  </action>
  <verify>
`python -c "from src.extraction.extraction_config import ExtractionConfig; c = ExtractionConfig(); print(c)"` shows defaults.
`python -c "from src.extraction.extraction_config import ExtractionConfig; ExtractionConfig(extraction_passes=6)"` raises ValueError.
  </verify>
  <done>ExtractionConfig validates all three fields within allowed ranges</done>
</task>

<task type="auto">
  <name>Task 2: Update LangExtractProcessor to use ExtractionConfig</name>
  <files>backend/src/extraction/langextract_processor.py</files>
  <action>
Modify `LangExtractProcessor.extract()` method:

1. Change signature from `extraction_passes: int = 2` to `config: ExtractionConfig | None = None`
2. At method start: `config = config or ExtractionConfig()`
3. Pass `config.extraction_passes`, `config.max_workers`, `config.max_char_buffer` to `lx.extract()`:
   ```python
   result: AnnotatedDocument = lx.extract(
       text_or_documents=document_text,
       prompt_description=self._get_prompt_description(),
       examples=self.examples,
       model_id=self._model_id,
       extraction_passes=config.extraction_passes,
       max_workers=config.max_workers,
       max_char_buffer=config.max_char_buffer,
   )
   ```

4. Add import at top: `from src.extraction.extraction_config import ExtractionConfig`

Do NOT change LangExtractResult or other methods.
  </action>
  <verify>
`python -c "from src.extraction.langextract_processor import LangExtractProcessor; from src.extraction.extraction_config import ExtractionConfig; print('imports work')"` succeeds.
  </verify>
  <done>LangExtractProcessor.extract() accepts ExtractionConfig and passes max_workers to lx.extract()</done>
</task>

<task type="auto">
  <name>Task 3: Create unit tests for ExtractionConfig</name>
  <files>backend/tests/unit/extraction/test_extraction_config.py</files>
  <action>
Create test file with pytest tests:

1. `test_default_values` - Verify defaults (extraction_passes=2, max_workers=10, max_char_buffer=1000)
2. `test_custom_valid_values` - Verify custom values within range work
3. `test_extraction_passes_minimum` - Verify extraction_passes=2 is valid
4. `test_extraction_passes_maximum` - Verify extraction_passes=5 is valid
5. `test_extraction_passes_below_minimum` - Verify extraction_passes=1 raises ValueError
6. `test_extraction_passes_above_maximum` - Verify extraction_passes=6 raises ValueError
7. `test_max_workers_minimum` - Verify max_workers=1 is valid
8. `test_max_workers_maximum` - Verify max_workers=50 is valid
9. `test_max_workers_below_minimum` - Verify max_workers=0 raises ValueError
10. `test_max_workers_above_maximum` - Verify max_workers=51 raises ValueError
11. `test_max_char_buffer_boundaries` - Verify 500 and 5000 are valid bounds
12. `test_max_char_buffer_out_of_range` - Verify 499 and 5001 raise ValueError

Use `pytest.raises(ValueError)` for negative cases. Each test should have a clear docstring.
  </action>
  <verify>
`cd backend && python -m pytest tests/unit/extraction/test_extraction_config.py -v` - all 12 tests pass.
  </verify>
  <done>12 unit tests covering all ExtractionConfig validation boundaries</done>
</task>

</tasks>

<verification>
- ExtractionConfig imports correctly from extraction_config module
- LangExtractProcessor.extract() accepts config parameter
- All 12 config validation tests pass
- Existing langextract_processor tests still pass (no regression)
</verification>

<success_criteria>
- LXTR-06: extraction_passes configurable 2-5 with validation
- LXTR-10: max_workers configurable 1-50 for parallel processing
- All tests pass: `cd backend && python -m pytest tests/unit/extraction/ -v`
</success_criteria>

<output>
After completion, create `.planning/phases/12-langextract-advanced-features/12-01-SUMMARY.md`
</output>
