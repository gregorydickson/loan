---
phase: 11-langextract-core-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/examples/__init__.py
  - backend/examples/borrower_examples.py
  - backend/examples/income_examples.py
  - backend/examples/account_examples.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Few-shot examples define borrower extraction patterns"
    - "Few-shot examples define income record extraction patterns"
    - "Few-shot examples define account number extraction patterns"
    - "All extraction_text values are verbatim from sample text (not paraphrased)"
  artifacts:
    - path: "backend/examples/__init__.py"
      provides: "Package initialization with exports"
      contains: "BORROWER_EXAMPLES"
    - path: "backend/examples/borrower_examples.py"
      provides: "Borrower extraction few-shot examples"
      contains: "ExampleData"
    - path: "backend/examples/income_examples.py"
      provides: "Income extraction few-shot examples"
      contains: "ExampleData"
    - path: "backend/examples/account_examples.py"
      provides: "Account extraction few-shot examples"
      contains: "ExampleData"
  key_links:
    - from: "backend/examples/__init__.py"
      to: "backend/examples/borrower_examples.py"
      via: "import and re-export"
      pattern: "from.*borrower_examples.*import"
---

<objective>
Create few-shot examples for LangExtract loan document extraction.

Purpose: LangExtract learns extraction patterns from few-shot examples rather than code-defined schemas. The examples must use verbatim text (not paraphrased) because LangExtract validates that extraction_text exactly matches text in the example source.

Output: examples/ directory with borrower, income, and account extraction examples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-langextract-core-integration/11-RESEARCH.md

@backend/src/models/borrower.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create examples package with borrower extraction examples</name>
  <files>backend/examples/__init__.py, backend/examples/borrower_examples.py</files>
  <action>
1. Create backend/examples/ directory

2. Create backend/examples/__init__.py with:
   - Import and re-export BORROWER_EXAMPLES from borrower_examples
   - Import and re-export INCOME_EXAMPLES from income_examples
   - Import and re-export ACCOUNT_EXAMPLES from account_examples
   - Add ALL_EXAMPLES list combining all example sets
   - Add module docstring explaining the examples/ purpose

3. Create backend/examples/borrower_examples.py with:
   - Import: `import langextract as lx`
   - Define SAMPLE_LOAN_TEXT_1 as a realistic loan document excerpt (multi-line string)
   - The sample text should include:
     * Borrower name clearly labeled
     * SSN in XXX-XX-XXXX format
     * Full address with street, city, state, ZIP
     * Phone number
     * Email address (optional)

   - Define BORROWER_EXAMPLES list with at least 2 ExampleData objects:

   Example structure (following research Pattern 1):
   ```python
   BORROWER_EXAMPLES = [
       lx.data.ExampleData(
           text=SAMPLE_LOAN_TEXT_1,
           extractions=[
               lx.data.Extraction(
                   extraction_class="borrower",
                   extraction_text="<exact name from text>",  # MUST be verbatim
                   attributes={
                       "ssn": "<exact SSN from text>",
                       "street": "<exact street from text>",
                       "city": "<exact city from text>",
                       "state": "<exact state from text>",
                       "zip_code": "<exact ZIP from text>",
                       "phone": "<exact phone from text>",
                       "email": "<exact email from text or None>"
                   }
               )
           ]
       ),
   ]
   ```

CRITICAL: All extraction_text and attribute values MUST appear verbatim in the sample text. LangExtract validates alignment - paraphrased examples cause "Prompt alignment warnings" and degrade quality.
  </action>
  <verify>
Run: `cd /Users/gregorydickson/stackpoint/loan/backend && python -c "from examples.borrower_examples import BORROWER_EXAMPLES; print(f'Loaded {len(BORROWER_EXAMPLES)} borrower examples')"`
Expected: "Loaded 2 borrower examples" (or similar count)
  </verify>
  <done>Borrower few-shot examples created with verbatim text extractions</done>
</task>

<task type="auto">
  <name>Task 2: Create income and account extraction examples</name>
  <files>backend/examples/income_examples.py, backend/examples/account_examples.py</files>
  <action>
1. Create backend/examples/income_examples.py with:
   - Import: `import langextract as lx`
   - Define SAMPLE_INCOME_TEXT_1 with realistic income section:
     * Employer name
     * Position/title
     * Annual salary with year (e.g., "$125,000 (2025)")
     * Multiple years if possible
     * Self-employment income example

   - Define INCOME_EXAMPLES list with ExampleData:
   ```python
   lx.data.Extraction(
       extraction_class="income",
       extraction_text="$125,000 (2025)",  # MUST be verbatim
       attributes={
           "amount": "125000",  # Numeric only, no currency symbol
           "period": "annual",
           "year": "2025",
           "source_type": "employment",
           "employer": "<exact employer from text>"
       }
   )
   ```

2. Create backend/examples/account_examples.py with:
   - Import: `import langextract as lx`
   - Define SAMPLE_ACCOUNT_TEXT_1 with account section:
     * Checking account number
     * Savings account number
     * Loan number

   - Define ACCOUNT_EXAMPLES list with ExampleData:
   ```python
   lx.data.Extraction(
       extraction_class="account",
       extraction_text="1234567890",  # MUST be verbatim account number
       attributes={"account_type": "checking"}
   ),
   lx.data.Extraction(
       extraction_class="loan",
       extraction_text="LN-2025-001234",  # MUST be verbatim loan number
       attributes={"loan_type": "mortgage"}
   )
   ```

3. Update backend/examples/__init__.py to import INCOME_EXAMPLES and ACCOUNT_EXAMPLES.

CRITICAL: All extraction_text values MUST be verbatim substrings of the sample text.
  </action>
  <verify>
Run: `cd /Users/gregorydickson/stackpoint/loan/backend && python -c "
from examples import BORROWER_EXAMPLES, INCOME_EXAMPLES, ACCOUNT_EXAMPLES, ALL_EXAMPLES
print(f'Borrower: {len(BORROWER_EXAMPLES)}')
print(f'Income: {len(INCOME_EXAMPLES)}')
print(f'Account: {len(ACCOUNT_EXAMPLES)}')
print(f'Total: {len(ALL_EXAMPLES)}')
"`
Expected: All example lists have at least 1 item, total is sum of all
  </verify>
  <done>Income and account few-shot examples created with verbatim text extractions</done>
</task>

<task type="auto">
  <name>Task 3: Validate examples for LangExtract alignment</name>
  <files>backend/examples/borrower_examples.py, backend/examples/income_examples.py, backend/examples/account_examples.py</files>
  <action>
Create a validation script (or add to __init__.py) that verifies all extraction_text values are verbatim substrings of their source text.

For each ExampleData in all example files:
1. Get the `text` field (source text)
2. For each Extraction in `extractions`:
   - Verify `extraction_text` appears in `text` (exact substring match)
   - If not found, the example is invalid

Add to backend/examples/__init__.py:
```python
def validate_examples() -> list[str]:
    """Validate all examples have verbatim extraction_text.

    Returns:
        List of error messages (empty if all valid)
    """
    errors = []
    for example in ALL_EXAMPLES:
        for extraction in example.extractions:
            if extraction.extraction_text not in example.text:
                errors.append(
                    f"extraction_text '{extraction.extraction_text[:50]}...' "
                    f"not found in example text for class '{extraction.extraction_class}'"
                )
    return errors
```

Run validation after creating examples to catch any issues.
  </action>
  <verify>
Run: `cd /Users/gregorydickson/stackpoint/loan/backend && python -c "
from examples import validate_examples
errors = validate_examples()
if errors:
    print('VALIDATION FAILED:')
    for e in errors:
        print(f'  - {e}')
else:
    print('All examples valid - extraction_text is verbatim')
"`
Expected: "All examples valid - extraction_text is verbatim"
  </verify>
  <done>All few-shot examples validated for verbatim text alignment</done>
</task>

</tasks>

<verification>
1. Examples package imports successfully:
   ```bash
   cd /Users/gregorydickson/stackpoint/loan/backend && python -c "
   from examples import BORROWER_EXAMPLES, INCOME_EXAMPLES, ACCOUNT_EXAMPLES
   print('Package imports OK')
   "
   ```

2. All examples have correct structure:
   ```bash
   cd /Users/gregorydickson/stackpoint/loan/backend && python -c "
   from examples import ALL_EXAMPLES
   for ex in ALL_EXAMPLES:
       assert hasattr(ex, 'text')
       assert hasattr(ex, 'extractions')
       for ext in ex.extractions:
           assert hasattr(ext, 'extraction_class')
           assert hasattr(ext, 'extraction_text')
           assert hasattr(ext, 'attributes')
   print('Structure OK')
   "
   ```

3. Validation passes:
   ```bash
   cd /Users/gregorydickson/stackpoint/loan/backend && python -c "
   from examples import validate_examples
   errors = validate_examples()
   assert not errors, f'Validation failed: {errors}'
   print('Validation OK')
   "
   ```
</verification>

<success_criteria>
1. backend/examples/ directory exists with __init__.py, borrower_examples.py, income_examples.py, account_examples.py
2. Each example file defines at least 1 ExampleData with realistic loan document text
3. All extraction_text values are verbatim substrings of source text (validated programmatically)
4. Examples cover: borrower (name, SSN, address, phone), income (amount, period, year, employer), accounts (checking, savings, loan numbers)
5. Requirements LXTR-04, LXTR-05, LXTR-12 are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/11-langextract-core-integration/11-02-SUMMARY.md`
</output>
