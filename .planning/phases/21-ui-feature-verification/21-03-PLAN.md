---
phase: 21-ui-feature-verification
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/badge.tsx
  - frontend/src/lib/formatting.ts
  - frontend/src/app/globals.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "High confidence scores (>= 70%) display green badges"
    - "Medium confidence scores (50-69%) display yellow badges"
    - "Low confidence scores (< 50%) display red badges"
    - "Dashboard table badges show appropriate semantic colors"
  artifacts:
    - path: "frontend/src/components/ui/badge.tsx"
      provides: "success and warning badge variants"
      contains: "success.*bg-green|warning.*bg-yellow"
    - path: "frontend/src/lib/formatting.ts"
      provides: "Updated variant mapping"
      contains: "success|warning"
    - path: "frontend/src/app/globals.css"
      provides: "Semantic color CSS variables"
      contains: "--success|--warning"
  key_links:
    - from: "frontend/src/lib/formatting.ts"
      to: "frontend/src/components/ui/badge.tsx"
      via: "getConfidenceBadgeVariant returns success/warning/destructive"
      pattern: "success.*warning.*destructive"
---

<objective>
Fix dashboard badge colors by adding semantic success (green) and warning (yellow) badge variants.

Purpose: Close TEST-08 gap where confidence score badges display dark gray instead of color-coded feedback (green/yellow/red).

Output: Badges display semantic colors - green for high confidence, yellow for medium, red for low.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@frontend/src/components/ui/badge.tsx
@frontend/src/lib/formatting.ts
@frontend/src/app/globals.css
</context>

<gap_context>
**Gap from 21-VERIFICATION.md:**

- truth: "Extraction visualizations render without errors (charts, timelines, confidence indicators)"
- status: partial
- reason: "Dashboard confidence badges render but use dark/monochrome theme color instead of semantic success/warning/error colors"

**Root Cause:**
- Theme defines `--primary` as dark gray (oklch 0.205 0 0) instead of semantic green
- Badge "default" variant maps to bg-primary (dark gray)
- `getConfidenceBadgeVariant` returns "default" for high scores, which renders dark

**Fix Strategy:**
- Add semantic CSS variables (--success, --warning) to globals.css
- Add success/warning variants to Badge component
- Update getConfidenceBadgeVariant to use success/warning/destructive
</gap_context>

<tasks>

<task type="auto">
  <name>Task 1: Add semantic color CSS variables</name>
  <files>frontend/src/app/globals.css</files>
  <action>
Add semantic color CSS variables to both light and dark theme sections in globals.css.

**In `:root` block (light theme), add after `--destructive` line (around line 65):**

```css
  --success: oklch(0.59 0.2 145);
  --success-foreground: oklch(1 0 0);
  --warning: oklch(0.75 0.18 85);
  --warning-foreground: oklch(0.205 0 0);
```

Colors chosen:
- Success: Green (oklch 0.59 0.2 145) - similar saturation to destructive but green hue (145)
- Warning: Yellow/amber (oklch 0.75 0.18 85) - warm amber hue (85) with good contrast

**In `.dark` block (dark theme), add after `--destructive` line (around line 99):**

```css
  --success: oklch(0.62 0.19 145);
  --success-foreground: oklch(0.145 0 0);
  --warning: oklch(0.72 0.17 85);
  --warning-foreground: oklch(0.145 0 0);
```

Dark mode colors have slightly adjusted lightness for better visibility on dark backgrounds.

**In `@theme inline` block, add color mappings (around line 27-28, after destructive):**

```css
  --color-success: var(--success);
  --color-success-foreground: var(--success-foreground);
  --color-warning: var(--warning);
  --color-warning-foreground: var(--warning-foreground);
```
  </action>
  <verify>
```bash
# Verify success and warning variables exist in CSS
grep -E "\-\-success|\-\-warning" /Users/gregorydickson/stackpoint/loan/frontend/src/app/globals.css | wc -l
# Should return 12 (6 lines each for success/warning across root, dark, and theme inline)
```
  </verify>
  <done>
- Success color variables added (green hue ~145)
- Warning color variables added (amber hue ~85)
- Both light and dark theme values defined
- Tailwind theme inline mappings added
  </done>
</task>

<task type="auto">
  <name>Task 2: Add success and warning badge variants</name>
  <files>frontend/src/components/ui/badge.tsx</files>
  <action>
Add success and warning variants to the badgeVariants in badge.tsx.

**In the variants object (after line 16, after destructive variant), add:**

```typescript
        success:
          "bg-success text-success-foreground [a&]:hover:bg-success/90",
        warning:
          "bg-warning text-warning-foreground [a&]:hover:bg-warning/90",
```

The variants follow the same pattern as existing variants:
- Background color from CSS variable
- Foreground text color from CSS variable
- Hover state at 90% opacity

**Full variants object should look like:**

```typescript
      variant: {
        default: "bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        success:
          "bg-success text-success-foreground [a&]:hover:bg-success/90",
        warning:
          "bg-warning text-warning-foreground [a&]:hover:bg-warning/90",
        outline:
          "border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        ghost: "[a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        link: "text-primary underline-offset-4 [a&]:hover:underline",
      },
```
  </action>
  <verify>
```bash
# Verify success and warning variants exist in badge.tsx
grep -E "success:|warning:" /Users/gregorydickson/stackpoint/loan/frontend/src/components/ui/badge.tsx
# Should show both success and warning variant definitions
```
  </verify>
  <done>
- success variant added with bg-success text-success-foreground
- warning variant added with bg-warning text-warning-foreground
- Both follow existing variant pattern
  </done>
</task>

<task type="auto">
  <name>Task 3: Update getConfidenceBadgeVariant to use semantic variants</name>
  <files>frontend/src/lib/formatting.ts</files>
  <action>
Update the getConfidenceBadgeVariant function to return semantic variant names.

**Replace the function (lines 16-22) with:**

```typescript
export function getConfidenceBadgeVariant(
  score: number
): "success" | "warning" | "destructive" {
  if (score >= 0.7) return "success";
  if (score >= 0.5) return "warning";
  return "destructive";
}
```

**Also update the JSDoc comment (lines 5-14) to reflect new mapping:**

```typescript
/**
 * Determines the badge variant based on confidence score.
 *
 * Used to provide visual feedback on extraction confidence:
 * - >= 0.7 (70%+): "success" - green, high confidence
 * - >= 0.5 (50-69%): "warning" - yellow/amber, medium confidence
 * - < 0.5 (0-49%): "destructive" - red, low confidence
 *
 * @param score - Confidence score between 0 and 1
 * @returns Badge variant for the shadcn Badge component
 */
```
  </action>
  <verify>
```bash
# Verify function returns new variant names
grep -E "success|warning" /Users/gregorydickson/stackpoint/loan/frontend/src/lib/formatting.ts
# Should show success and warning in return type and return statements
```
  </verify>
  <done>
- Return type updated to "success" | "warning" | "destructive"
- >= 0.7 returns "success" (was "default")
- >= 0.5 returns "warning" (was "secondary")
- < 0.5 returns "destructive" (unchanged)
- JSDoc updated to reflect new color meanings
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
```bash
cd /Users/gregorydickson/stackpoint/loan/frontend && npm run build
```
Build should complete without TypeScript errors.

2. **Visual verification (local):**
```bash
cd /Users/gregorydickson/stackpoint/loan/frontend && npm run dev
```
Navigate to http://localhost:3000/borrowers and verify:
- High confidence (>=70%) badges are green
- Medium confidence (50-69%) badges are yellow/amber
- Low confidence (<50%) badges are red

3. **Code verification:**
```bash
# Check all files have the expected patterns
grep "success" /Users/gregorydickson/stackpoint/loan/frontend/src/components/ui/badge.tsx
grep "success" /Users/gregorydickson/stackpoint/loan/frontend/src/lib/formatting.ts
grep "\-\-success" /Users/gregorydickson/stackpoint/loan/frontend/src/app/globals.css
```
</verification>

<success_criteria>
- [ ] CSS variables --success and --warning defined in both light and dark themes
- [ ] Badge component has success and warning variants
- [ ] getConfidenceBadgeVariant returns success/warning/destructive
- [ ] Frontend builds without errors
- [ ] Confidence badges display semantic colors (green/yellow/red)
</success_criteria>

<output>
After completion:
1. Create `.planning/phases/21-ui-feature-verification/21-03-SUMMARY.md`
2. Commit changes with message: `fix(21-03): add semantic badge colors for confidence scores`
3. Trigger frontend deployment (CloudBuild auto-triggers on push)
</output>
