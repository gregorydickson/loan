---
phase: 20-core-extraction-verification
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Production frontend URL loads in Chrome browser"
    - "User can upload a PDF document through the UI"
    - "Upload confirmation shows document ID"
    - "Extraction results exist after document processing completes"
  artifacts: []
  key_links:
    - from: "Frontend UI"
      to: "Backend /api/documents/"
      via: "POST multipart/form-data"
      pattern: "fetch.*api/documents"
---

<objective>
Verify frontend loads and document upload flow works in production.

Purpose: Covers TEST-01 (frontend navigation) and TEST-02 (upload flow) requirements. These are foundational verifications that must pass before testing extraction methods.

Output: Evidence that frontend loads correctly and uploads succeed with actual extraction results
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-core-extraction-verification/20-RESEARCH.md
@.planning/phases/20-core-extraction-verification/20-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify API baseline with curl</name>
  <files></files>
  <action>
    Before browser testing, verify APIs are responding correctly:

    ```bash
    BACKEND_URL="https://loan-backend-prod-fjz2snvxjq-uc.a.run.app"
    FRONTEND_URL="https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app"

    # Health check
    curl -s "${BACKEND_URL}/health"
    # Expected: {"status":"healthy"}

    # Document list (requires working DB from 20-01)
    curl -s "${BACKEND_URL}/api/documents/"
    # Expected: {"documents":[],"total":0,...}

    # Frontend responds
    curl -s -o /dev/null -w "%{http_code}" "${FRONTEND_URL}"
    # Expected: 200
    ```

    If any fail, troubleshoot before proceeding to browser testing.
  </action>
  <verify>
    All three curl commands return expected results:
    - /health: 200 + healthy status
    - /api/documents/: 200 + JSON (not 500)
    - frontend: 200 HTTP code
  </verify>
  <done>
    - Backend health check passes
    - Document endpoint returns JSON (empty list OK)
    - Frontend URL returns 200
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify frontend loads in Chrome (TEST-01)</name>
  <what-built>
    Production frontend deployed to Cloud Run at:
    https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app

    Expected features:
    - Next.js dashboard application
    - Sidebar with Documents, Borrowers, Architecture links
    - No console errors
  </what-built>
  <how-to-verify>
    1. Open Chrome browser
    2. Press F12 to open DevTools
    3. Go to Console tab
    4. Navigate to: https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app
    5. Verify:
       - [ ] Page loads without blank screen
       - [ ] Sidebar navigation visible (Documents, Borrowers, Architecture)
       - [ ] No red errors in Console tab
       - [ ] Page title shows "Loan Document Extraction" or similar
    6. Go to Network tab, filter by "XHR"
    7. Refresh page, observe API calls
    8. Verify:
       - [ ] API calls go to loan-backend-prod URL
       - [ ] API calls return 200 (not CORS errors)
  </how-to-verify>
  <resume-signal>
    Type "TEST-01 PASS" if frontend loads correctly with no errors.
    Type "TEST-01 FAIL: [description]" if there are issues.
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify document upload flow with extraction results (TEST-02)</name>
  <what-built>
    Document upload interface with:
    - Method selector (Docling vs LangExtract)
    - OCR mode selector (auto vs force)
    - Drag-and-drop or click-to-upload zone
    - Progress indicator and success message

    Test document location:
    loan-docs/Loan 214/Paystub- John Homeowner (Current).pdf (143KB)
  </what-built>
  <how-to-verify>
    1. In Chrome with DevTools open (Network tab, filter XHR)
    2. Navigate to Documents page (sidebar link)
    3. Verify upload zone is visible
    4. Leave defaults (Docling, auto)
    5. Click upload zone or drag/drop test PDF:
       - Use: loan-docs/Loan 214/Paystub- John Homeowner (Current).pdf
    6. Observe:
       - [ ] Upload progress indicator appears
       - [ ] Success message shows document ID (UUID format)
       - [ ] Network tab shows POST /api/documents/ with 201 response
       - [ ] Document appears in document list below
    7. Click on document in list
    8. Verify document details show:
       - [ ] Filename matches uploaded file
       - [ ] Status shows "completed" (may take a few seconds)
       - [ ] extraction_method shows "docling"

    **CRITICAL: Verify extraction results exist (not just upload status):**
    9. Check extraction_results field is populated:
       ```bash
       # Replace DOC_ID with the actual document ID from step 6
       curl -s "https://loan-backend-prod-fjz2snvxjq-uc.a.run.app/api/documents/DOC_ID" | jq '.extraction_results'
       # Expected: Non-null object with extracted data (e.g., borrower_name, employer, etc.)
       # NOT expected: null or empty {}
       ```
    10. Verify borrower was created from extraction:
       - Navigate to Borrowers page
       - [ ] A borrower record exists (e.g., "John Homeowner")
       - OR check via API:
       ```bash
       curl -s "https://loan-backend-prod-fjz2snvxjq-uc.a.run.app/api/borrowers/" | jq '.borrowers'
       # Expected: At least one borrower record from the extraction
       ```
  </how-to-verify>
  <resume-signal>
    Type "TEST-02 PASS" if upload flow works AND extraction results exist.
    Type "TEST-02 PARTIAL: [description]" if upload works but extraction results empty.
    Type "TEST-02 FAIL: [description]" if there are issues.

    Include:
    - Document ID from successful upload
    - Sample extraction_results field (or confirmation it's populated)
    - Borrower name if visible
  </resume-signal>
</task>

</tasks>

<verification>
Requirements verification:

| Requirement | Test | Expected Result |
|-------------|------|-----------------|
| TEST-01 | Navigate to frontend URL | Page loads, no errors |
| TEST-02 | Upload document | Success message, document in list, **extraction_results populated** |

Both requirements must pass before proceeding to Plan 20-03.

**Note:** TEST-02 is only complete when:
1. Document uploads successfully (status 201)
2. Document status changes to "completed"
3. extraction_results field contains actual extracted data (not null/empty)
</verification>

<success_criteria>
- [ ] TEST-01 PASS: Frontend loads in Chrome without errors
- [ ] TEST-02 PASS: Document upload completes successfully
- [ ] Network tab confirms API communication working
- [ ] No CORS errors in console
- [ ] At least one document uploaded and showing "completed" status
- [ ] extraction_results field is populated with extracted data
- [ ] Borrower record created from extraction (visible in Borrowers page or API)
</success_criteria>

<output>
After completion, create `.planning/phases/20-core-extraction-verification/20-02-SUMMARY.md`

Include:
- TEST-01 result with any notes
- TEST-02 result with document ID
- Sample extraction_results showing what data was extracted
- Borrower name extracted
- Screenshots or observations if relevant
- Any issues encountered and workarounds
</output>
