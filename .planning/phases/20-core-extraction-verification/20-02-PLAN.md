---
phase: 20-core-extraction-verification
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Production frontend URL loads in Chrome browser"
    - "User can upload a PDF document through the UI"
    - "Upload confirmation shows document ID"
    - "Document status shows processing or completed"
  artifacts: []
  key_links:
    - from: "Frontend UI"
      to: "Backend /api/documents/"
      via: "POST multipart/form-data"
      pattern: "fetch.*api/documents"
---

<objective>
Verify frontend loads and document upload mechanism works in production.

Purpose: Covers TEST-01 (frontend navigation) and TEST-02 (upload flow) requirements. This plan verifies the upload MECHANISM works. Extraction result verification is covered in Plan 20-03 (TEST-03).

Output: Evidence that frontend loads correctly and uploads are accepted by the backend
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-core-extraction-verification/20-RESEARCH.md
@.planning/phases/20-core-extraction-verification/20-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify API baseline with curl</name>
  <files></files>
  <action>
    Before browser testing, verify APIs are responding correctly:

    ```bash
    BACKEND_URL="https://loan-backend-prod-fjz2snvxjq-uc.a.run.app"
    FRONTEND_URL="https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app"

    # Health check
    curl -s "${BACKEND_URL}/health"
    # Expected: {"status":"healthy"}

    # Document list (requires working DB from 20-01)
    curl -s "${BACKEND_URL}/api/documents/"
    # Expected: {"documents":[],"total":0,...}

    # Frontend responds
    curl -s -o /dev/null -w "%{http_code}" "${FRONTEND_URL}"
    # Expected: 200
    ```

    If any fail, troubleshoot before proceeding to browser testing.
  </action>
  <verify>
    All three curl commands return expected results:
    - /health: 200 + healthy status
    - /api/documents/: 200 + JSON (not 500)
    - frontend: 200 HTTP code
  </verify>
  <done>
    - Backend health check passes
    - Document endpoint returns JSON (empty list OK)
    - Frontend URL returns 200
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify frontend loads in Chrome (TEST-01)</name>
  <what-built>
    Production frontend deployed to Cloud Run at:
    https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app

    Expected features:
    - Next.js dashboard application
    - Sidebar with Documents, Borrowers, Architecture links
    - No console errors
  </what-built>
  <how-to-verify>
    1. Open Chrome browser
    2. Press F12 to open DevTools
    3. Go to Console tab
    4. Navigate to: https://loan-frontend-prod-fjz2snvxjq-uc.a.run.app
    5. Verify:
       - [ ] Page loads without blank screen
       - [ ] Sidebar navigation visible (Documents, Borrowers, Architecture)
       - [ ] No red errors in Console tab
       - [ ] Page title shows "Loan Document Extraction" or similar
    6. Go to Network tab, filter by "XHR"
    7. Refresh page, observe API calls
    8. Verify:
       - [ ] API calls go to loan-backend-prod URL
       - [ ] API calls return 200 (not CORS errors)
  </how-to-verify>
  <resume-signal>
    Type "TEST-01 PASS" if frontend loads correctly with no errors.
    Type "TEST-01 FAIL: [description]" if there are issues.
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify document upload mechanism works (TEST-02)</name>
  <what-built>
    Document upload interface with:
    - Method selector (Docling vs LangExtract)
    - OCR mode selector (auto vs force)
    - Drag-and-drop or click-to-upload zone
    - Progress indicator and success message

    Test document location:
    loan-docs/Loan 214/Paystub- John Homeowner (Current).pdf (143KB)
  </what-built>
  <how-to-verify>
    1. In Chrome with DevTools open (Network tab, filter XHR)
    2. Navigate to Documents page (sidebar link)
    3. Verify upload zone is visible
    4. Leave defaults (Docling, auto)
    5. Click upload zone or drag/drop test PDF:
       - Use: loan-docs/Loan 214/Paystub- John Homeowner (Current).pdf
    6. Observe:
       - [ ] Upload progress indicator appears
       - [ ] Success message shows document ID (UUID format)
       - [ ] Network tab shows POST /api/documents/ with 201 response
       - [ ] Document appears in document list below
    7. Click on document in list
    8. Verify document record shows:
       - [ ] Filename matches uploaded file
       - [ ] Status shows "processing" or "completed"
       - [ ] extraction_method shows "docling"

    **SCOPE NOTE:** This task verifies the upload MECHANISM works (201 response, document record created).
    Extraction RESULTS verification (actual extracted data) is covered in Plan 20-03 Task 1 (TEST-03).
  </how-to-verify>
  <resume-signal>
    Type "TEST-02 PASS" if upload mechanism works (document accepted with 201 response).
    Type "TEST-02 FAIL: [description]" if there are issues.

    Include:
    - Document ID from successful upload
    - Document status (processing/completed)
    - Network response code observed
  </resume-signal>
</task>

</tasks>

<verification>
Requirements verification:

| Requirement | Test | Expected Result |
|-------------|------|-----------------|
| TEST-01 | Navigate to frontend URL | Page loads, no errors |
| TEST-02 | Upload document | 201 response, document record created, status shows processing/completed |

Both requirements must pass before proceeding to Plan 20-03.

**Scope clarification:**
- TEST-02 = Upload mechanism works (file accepted, document record created)
- TEST-03 = Extraction results correct (borrower data extracted) - verified in Plan 20-03
</verification>

<success_criteria>
- [ ] TEST-01 PASS: Frontend loads in Chrome without errors
- [ ] TEST-02 PASS: Document upload returns 201 and creates document record
- [ ] Network tab confirms API communication working
- [ ] No CORS errors in console
- [ ] At least one document uploaded with "processing" or "completed" status
- [ ] Document ID captured for use in Plan 20-03
</success_criteria>

<output>
After completion, create `.planning/phases/20-core-extraction-verification/20-02-SUMMARY.md`

Include:
- TEST-01 result with any notes
- TEST-02 result with document ID and status
- Network observations (response codes, timing)
- Document ID(s) for use in Plan 20-03 extraction verification
- Any issues encountered and workarounds

**Important:** Record document ID - Plan 20-03 will verify extraction results for this document.
</output>
