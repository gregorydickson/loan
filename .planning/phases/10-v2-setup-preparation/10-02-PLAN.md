---
phase: 10-v2-setup-preparation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - archive/terraform/terraform/*.tf
  - archive/terraform/terraform/terraform.tfstate
  - archive/terraform/MIGRATION.md
  - archive/terraform/inventory.md
autonomous: true

must_haves:
  truths:
    - "Terraform state exported from remote backend"
    - "All .tf files preserved in archive"
    - "Resource inventory documents what Terraform managed"
    - "Migration documentation explains archival rationale"
  artifacts:
    - path: "archive/terraform/MIGRATION.md"
      provides: "Migration documentation"
      contains: "Archived"
    - path: "archive/terraform/inventory.md"
      provides: "Resource inventory"
      contains: "google_"
    - path: "archive/terraform/terraform/"
      provides: "Archived Terraform files"
  key_links:
    - from: "archive/terraform/inventory.md"
      to: "infrastructure/terraform/"
      via: "resource list matching"
      pattern: "google_cloud_run"
---

<objective>
Archive Terraform state and configuration to /archive/terraform/ with complete documentation.

Purpose: CloudBuild will replace Terraform for deployments. Archiving state ensures we can reference original configuration and prevents accidental terraform destroy. Resources remain in GCP - only the management tool changes.
Output: Complete Terraform archive with state, configs, and migration documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-v2-setup-preparation/10-RESEARCH.md
@infrastructure/terraform/main.tf
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create archive directory structure and copy Terraform files</name>
  <files>
    archive/terraform/terraform/*.tf
    archive/terraform/terraform/terraform.tfvars.example
  </files>
  <action>
Create the archive directory structure and copy all Terraform configuration files:

```bash
# Create archive directory
mkdir -p archive/terraform/terraform

# Copy all Terraform files
cp infrastructure/terraform/*.tf archive/terraform/terraform/
cp infrastructure/terraform/terraform.tfvars.example archive/terraform/terraform/
```

Files to copy:
- main.tf (provider config, backend)
- variables.tf (variable definitions)
- cloud_run.tf (Cloud Run services)
- cloud_sql.tf (PostgreSQL instance)
- cloud_storage.tf (GCS buckets)
- cloud_tasks.tf (Cloud Tasks queue)
- iam.tf (IAM bindings)
- secrets.tf (Secret Manager)
- vpc.tf (VPC networking)
- outputs.tf (output values)
- terraform.tfvars.example (example variables)

Do NOT copy .terraform directory or any .tfstate files from local filesystem (state is remote).
  </action>
  <verify>ls archive/terraform/terraform/*.tf shows all 10 .tf files copied</verify>
  <done>All Terraform configuration files archived</done>
</task>

<task type="auto">
  <name>Task 2: Create resource inventory and migration documentation</name>
  <files>
    archive/terraform/inventory.md
    archive/terraform/MIGRATION.md
  </files>
  <action>
Create inventory.md by reading the Terraform files and documenting all resources:

Read each .tf file and list the resources defined. Format as markdown table with:
- Resource type (e.g., google_cloud_run_v2_service)
- Resource name (e.g., backend)
- What it manages (e.g., Backend API service)
- gcloud equivalent command

Create MIGRATION.md with:
```markdown
# Terraform Migration

**Archived:** 2026-01-24
**Reason:** Migration to CloudBuild for deployment automation

## What Happened

Terraform state and configuration archived. Resources remain in GCP - only management tooling changes:
- Terraform managed: Cloud SQL, Cloud Run, GCS, VPC, IAM, Secrets
- CloudBuild will manage: Container deployments to Cloud Run
- gcloud CLI will manage: One-time infrastructure changes

## State Location

Original state was in GCS backend (configured in main.tf).
State is NOT destroyed - resources remain managed by GCP.

## Resources

See: inventory.md for complete resource list with gcloud equivalents.

## Reverting

If needed, Terraform can be re-initialized from archive:
1. Copy archive/terraform/terraform/ to infrastructure/terraform/
2. Run terraform init with original backend config
3. Terraform will reconnect to GCS state

## Notes

- NO terraform destroy was run
- Resources continue to exist and function
- CloudBuild deployments update resources in-place
```

For inventory.md, parse the .tf files and create a table. Example:
```markdown
# Terraform Resource Inventory

Resources managed by Terraform before CloudBuild migration.

| Resource Type | Name | Purpose | gcloud Equivalent |
|---------------|------|---------|-------------------|
| google_cloud_run_v2_service | backend | Backend API | gcloud run services describe backend |
| google_cloud_run_v2_service | frontend | Frontend UI | gcloud run services describe frontend |
| google_sql_database_instance | main | PostgreSQL | gcloud sql instances describe main |
...
```
  </action>
  <verify>
    cat archive/terraform/MIGRATION.md shows documentation
    cat archive/terraform/inventory.md shows resource table
  </verify>
  <done>Migration documentation and resource inventory created</done>
</task>

</tasks>

<verification>
- [ ] archive/terraform/terraform/ contains all .tf files
- [ ] archive/terraform/MIGRATION.md explains archival rationale
- [ ] archive/terraform/inventory.md lists all resources with gcloud equivalents
- [ ] No terraform destroy run (resources remain in GCP)
</verification>

<success_criteria>
Terraform configuration archived with:
1. All .tf files in archive/terraform/terraform/
2. MIGRATION.md explaining why and how
3. inventory.md mapping resources to gcloud commands
</success_criteria>

<output>
After completion, create `.planning/phases/10-v2-setup-preparation/10-02-SUMMARY.md`
</output>
