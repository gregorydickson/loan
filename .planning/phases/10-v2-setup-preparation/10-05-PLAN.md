---
phase: 10-v2-setup-preparation
plan: 05
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "CloudBuild service account cloudbuild-deployer@memorygraph-prod.iam.gserviceaccount.com exists in GCP"
    - "Service account has 5 required IAM roles granted"
  artifacts:
    - path: "GCP IAM"
      provides: "cloudbuild-deployer service account with IAM roles"
      external: true
  key_links:
    - from: "setup-service-account.sh"
      to: "GCP IAM"
      via: "gcloud iam service-accounts create + projects add-iam-policy-binding"
      pattern: "gcloud iam service-accounts"
---

<objective>
Execute the existing CloudBuild service account setup script to close CBLD-08 gap.

Purpose: The setup script exists and is correct, but was never executed. The service account does not exist in GCP, blocking Phase 13 (LightOnOCR GPU) and Phase 16 (CloudBuild configs). This gap closure plan executes the script and verifies the service account is created.

Output: Service account cloudbuild-deployer@memorygraph-prod.iam.gserviceaccount.com exists in GCP with 5 IAM roles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/10-v2-setup-preparation/10-VERIFICATION.md
@infrastructure/cloudbuild/setup-service-account.sh
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Execute CloudBuild service account setup script</name>
  <action>
Execute the existing setup script to create the CloudBuild service account in GCP.

**Background:** This script was created in 10-03-PLAN.md but never executed. The checkpoint was marked approved without the user actually running the script.
  </action>
  <instructions>
**Step 1: Verify GCP authentication**
```bash
gcloud auth list
gcloud config get-value project
```
Expected: Shows your authenticated account and project (memorygraph-prod or similar).

**Step 2: Execute the setup script**
```bash
cd /Users/gregorydickson/stackpoint/loan
./infrastructure/cloudbuild/setup-service-account.sh memorygraph-prod
```
Expected output:
- "Setting up CloudBuild service account for project: memorygraph-prod"
- "Creating service account: cloudbuild-deployer"
- 5 lines showing "Granting: roles/..." for each IAM role
- "CloudBuild service account setup complete!"

**Step 3: Verify service account exists**
```bash
gcloud iam service-accounts describe cloudbuild-deployer@memorygraph-prod.iam.gserviceaccount.com
```
Expected: Shows service account details (email, displayName, description).

**Step 4: Verify IAM roles granted**
```bash
gcloud projects get-iam-policy memorygraph-prod \
  --flatten="bindings[].members" \
  --filter="bindings.members~cloudbuild-deployer" \
  --format="table(bindings.role)"
```
Expected: Shows 5 roles:
- roles/artifactregistry.writer
- roles/iam.serviceAccountUser
- roles/logging.logWriter
- roles/run.developer
- roles/secretmanager.secretAccessor
  </instructions>
  <resume-signal>
Paste the output of the final two verification commands (gcloud iam service-accounts describe and gcloud projects get-iam-policy).

Type "approved" with the verification output, or describe any errors encountered.
  </resume-signal>
</task>

</tasks>

<verification>
- [ ] gcloud iam service-accounts describe cloudbuild-deployer@memorygraph-prod.iam.gserviceaccount.com returns account details (not NOT_FOUND)
- [ ] gcloud projects get-iam-policy shows 5 IAM roles bound to the service account
- [ ] CBLD-08 requirement is satisfied
</verification>

<success_criteria>
Gap closed when:
1. Service account cloudbuild-deployer@memorygraph-prod.iam.gserviceaccount.com exists in GCP
2. All 5 IAM roles are granted (run.developer, iam.serviceAccountUser, artifactregistry.writer, secretmanager.secretAccessor, logging.logWriter)
3. Verification commands confirm the service account and roles
</success_criteria>

<output>
After completion, create `.planning/phases/10-v2-setup-preparation/10-05-SUMMARY.md`

The summary should include:
- Actual output from the setup script execution
- Verification command outputs confirming service account exists
- Confirmation that CBLD-08 is now satisfied
</output>
