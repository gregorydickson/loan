---
phase: 05-frontend-dashboard
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/borrowers/borrower-card.tsx
  - frontend/src/app/borrowers/[id]/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Borrower detail page displays BorrowerCard component at top of page"
    - "BorrowerCard does not wrap content in Link when used on detail page"
  artifacts:
    - path: "frontend/src/components/borrowers/borrower-card.tsx"
      provides: "Reusable borrower card with optional link behavior"
      exports: ["BorrowerCard"]
    - path: "frontend/src/app/borrowers/[id]/page.tsx"
      provides: "Borrower detail page with BorrowerCard"
      contains: "BorrowerCard"
  key_links:
    - from: "frontend/src/app/borrowers/[id]/page.tsx"
      to: "frontend/src/components/borrowers/borrower-card.tsx"
      via: "Import and render BorrowerCard"
      pattern: "import.*BorrowerCard"
---

<objective>
Close verification gap: Wire BorrowerCard component into borrower detail page.

Purpose: The verification report identified that BorrowerCard (50 lines) exists but is not imported or used in the detail page. The original plan (05-03) specified "BorrowerCard at top for summary" in the detail page structure.

Output: BorrowerCard rendered at top of borrower detail page, showing summary information before the two-column layout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-dashboard**/05-VERIFICATION.md
@.planning/phases/05-frontend-dashboard**/05-03-SUMMARY.md

Reference files:
@frontend/src/components/borrowers/borrower-card.tsx
@frontend/src/app/borrowers/[id]/page.tsx
@frontend/src/lib/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire BorrowerCard into detail page</name>
  <files>
    frontend/src/components/borrowers/borrower-card.tsx
    frontend/src/app/borrowers/[id]/page.tsx
  </files>
  <action>
    **Problem:** BorrowerCard wraps content in a Link to /borrowers/[id], which would be circular on the detail page. Also, BorrowerCard takes BorrowerSummary but detail page has BorrowerDetailResponse.

    **Solution:** Modify BorrowerCard to accept optional props that disable linking and support detail response type.

    1. Update `borrower-card.tsx`:
       - Change props to accept either BorrowerSummary OR BorrowerDetailResponse
       - Add optional `disableLink?: boolean` prop (default false)
       - When disableLink is true, render Card without Link wrapper
       - For income count: use `income_count` if present, else count `income_records.length` if array exists

       Updated interface:
       ```tsx
       interface BorrowerCardProps {
         borrower: BorrowerSummary | {
           id: string;
           name: string;
           confidence_score: string;
           created_at: string;
           income_records?: { length: number };
           income_count?: number;
         };
         disableLink?: boolean;
       }
       ```

       Compute income count safely:
       ```tsx
       const incomeCount = 'income_count' in borrower
         ? borrower.income_count
         : borrower.income_records?.length ?? 0;
       ```

       Conditional wrapper:
       ```tsx
       const CardWrapper = disableLink ? React.Fragment : Link;
       const wrapperProps = disableLink ? {} : { href: `/borrowers/${borrower.id}` };

       return (
         <CardWrapper {...wrapperProps}>
           <Card className={disableLink ? '' : 'hover:shadow-md transition-shadow cursor-pointer'}>
             ...
           </Card>
         </CardWrapper>
       );
       ```

    2. Update `app/borrowers/[id]/page.tsx`:
       - Add import: `import { BorrowerCard } from "@/components/borrowers/borrower-card";`
       - Add BorrowerCard after the header section, before the Summary Card
       - Pass disableLink={true} to prevent circular linking
       - The existing Summary Card can remain (it shows additional details) OR can be removed since BorrowerCard now handles summary

       Add after the header (around line 136):
       ```tsx
       {/* Borrower Card Summary */}
       <BorrowerCard borrower={borrower} disableLink />
       ```

    **Decision:** Keep both BorrowerCard AND Summary Card. BorrowerCard provides the compact view matching list items, Summary Card provides expanded metrics (4 stats). This gives users visual continuity from list to detail while showing more information.

    **Simpler alternative (PREFER THIS):** Since the detail page already has a well-designed Summary Card with MORE information than BorrowerCard would show, instead modify the approach:
    - Keep the existing Summary Card (it's better for detail pages)
    - Use BorrowerCard on detail page only if we want visual consistency with list view
    - OR mark BorrowerCard as list-only and document that detail page uses custom Summary Card

    **Final approach:** Add BorrowerCard above the Summary Card for visual continuity with the list view. Users see the same card style they clicked on, then get expanded details below.
  </action>
  <verify>
    1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
    2. Run dev server: `cd frontend && npm run dev`
    3. Navigate to /borrowers, click a borrower
    4. Detail page shows BorrowerCard at top (same style as list view card)
    5. BorrowerCard is NOT wrapped in a link (no cursor-pointer, no navigation on click)
    6. Summary Card still appears below with expanded metrics
  </verify>
  <done>
    BorrowerCard imported and rendered at top of borrower detail page with disableLink prop preventing circular navigation. Detail page now matches verification criteria "BorrowerCard at top for summary".
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` - TypeScript compiles without errors
2. `cd frontend && npm run dev` - Dev server starts
3. Navigate to /borrowers - see list with BorrowerCard-styled rows
4. Click borrower row - navigates to detail page
5. Detail page shows BorrowerCard component at top
6. BorrowerCard does not navigate when clicked (disableLink active)
7. Summary Card displays below with 4 stats
8. Income timeline and source references in two-column layout below
</verification>

<success_criteria>
- BorrowerCard component imported in borrowers/[id]/page.tsx
- BorrowerCard rendered in detail page before Summary Card
- BorrowerCard accepts disableLink prop to prevent circular linking
- TypeScript compilation passes
- Visual verification: detail page shows BorrowerCard at top
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-dashboard**/05-05-SUMMARY.md`
</output>
