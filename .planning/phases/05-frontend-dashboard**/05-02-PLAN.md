---
phase: 05-frontend-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/hooks/use-documents.ts
  - frontend/src/components/documents/upload-zone.tsx
  - frontend/src/components/documents/status-badge.tsx
  - frontend/src/components/documents/document-table.tsx
  - frontend/src/app/documents/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag and drop a PDF file onto the upload zone"
    - "Upload zone shows loading state during upload"
    - "Document list shows filename, status badge, and page count"
    - "Status badge reflects document processing status (pending, completed, failed)"
  artifacts:
    - path: "frontend/src/hooks/use-documents.ts"
      provides: "Document query and mutation hooks"
      exports: ["useUploadDocument", "useDocuments", "useDocumentStatus"]
    - path: "frontend/src/components/documents/upload-zone.tsx"
      provides: "Drag-and-drop file upload component"
      exports: ["UploadZone"]
    - path: "frontend/src/components/documents/document-table.tsx"
      provides: "Document list table with columns"
      exports: ["DocumentTable"]
    - path: "frontend/src/app/documents/page.tsx"
      provides: "Documents page combining upload and list"
      min_lines: 30
  key_links:
    - from: "frontend/src/hooks/use-documents.ts"
      to: "frontend/src/lib/api/documents.ts"
      via: "Import API functions"
      pattern: "import.*from.*api/documents"
    - from: "frontend/src/components/documents/upload-zone.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useUploadDocument hook"
      pattern: "useUploadDocument"
    - from: "frontend/src/app/documents/page.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useDocuments hook for list"
      pattern: "useDocuments"
---

<objective>
Build the document upload and listing feature with drag-and-drop upload and status tracking.

Purpose: Enable users to upload loan documents and see processing status (Success Criteria #1).
Output: Working /documents page with drag-drop upload zone and document list table.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-dashboard**/05-RESEARCH.md
@.planning/phases/05-frontend-dashboard**/05-01-SUMMARY.md

Reference files from Plan 01:
@frontend/src/lib/api/documents.ts (API functions)
@frontend/src/lib/api/types.ts (TypeScript types)
@frontend/src/lib/query-client.ts (QueryClient config)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create document hooks</name>
  <files>frontend/src/hooks/use-documents.ts</files>
  <action>
    Create `hooks/use-documents.ts` (client component patterns):

    1. useUploadDocument():
       - useMutation wrapping uploadDocument API
       - On success: invalidate ["documents"] query
       - Return mutate, isPending, isSuccess, error, data

    2. useDocuments(limit?, offset?):
       - useQuery with queryKey ["documents", limit, offset]
       - Fetch from listDocuments API

    3. useDocumentStatus(documentId: string | null):
       - useQuery with queryKey ["document-status", documentId]
       - enabled: !!documentId
       - refetchInterval: conditional polling
         - Return 2000ms if status is "pending" or "processing"
         - Return false (stop polling) if "completed" or "failed"
       - This implements status polling as per research Pattern 3

    All hooks should be typed with the types from lib/api/types.ts.
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npx tsc --noEmit` passes.
  </verify>
  <done>Document hooks export useUploadDocument, useDocuments, useDocumentStatus</done>
</task>

<task type="auto">
  <name>Task 2: Create document UI components</name>
  <files>
    frontend/src/components/documents/upload-zone.tsx
    frontend/src/components/documents/status-badge.tsx
    frontend/src/components/documents/document-table.tsx
  </files>
  <action>
    Create `components/documents/upload-zone.tsx`:
    - "use client" directive
    - Use react-dropzone useDropzone hook
    - Accept: PDF, DOCX, PNG, JPG (see research Pattern 2 for accept config)
    - maxFiles: 1, disabled when isPending
    - Visual states:
      - Default: dashed border, "Drag and drop a file here, or click to select"
      - Drag active: border-primary, bg-primary/5
      - Uploading: opacity-50, "Uploading..."
      - Success: Show success message with document ID
      - Error: Show error message
    - On drop, call mutate with file[0]
    - Use cn() for conditional classes (from lib/utils)

    Create `components/documents/status-badge.tsx`:
    - Props: status: DocumentStatus
    - Map status to Badge variants:
      - pending: secondary, "Pending"
      - processing: outline, "Processing"
      - completed: default (green-ish), "Completed"
      - failed: destructive, "Failed"
    - Use Badge from shadcn/ui

    Create `components/documents/document-table.tsx`:
    - "use client" directive
    - Props: documents: DocumentResponse[]
    - Use @tanstack/react-table for column definitions
    - Columns:
      - Filename (accessorKey: "filename")
      - Status (custom cell with StatusBadge)
      - Pages (accessorKey: "page_count", show "-" if null)
      - Size (file_size_bytes formatted as KB/MB)
      - Type (file_type)
    - Use Table components from shadcn/ui (Table, TableHeader, TableBody, TableRow, TableHead, TableCell)
    - Add click handler on rows to navigate to document detail (optional, can be added later)
  </action>
  <verify>
    Components exist and export correctly. TypeScript compiles.
  </verify>
  <done>Upload zone, status badge, and document table components created</done>
</task>

<task type="auto">
  <name>Task 3: Create documents page</name>
  <files>frontend/src/app/documents/page.tsx</files>
  <action>
    Create `app/documents/page.tsx`:
    - "use client" directive (needed for hooks)
    - Import useDocuments and UploadZone, DocumentTable
    - Page structure:
      1. Page header: "Documents" title
      2. Upload section: Card containing UploadZone
      3. Document list section: Card containing DocumentTable
         - Show Skeleton while loading
         - Show "No documents yet" if empty
         - Show DocumentTable when data loaded

    Layout:
    ```
    <div className="p-6 space-y-6">
      <h1 className="text-3xl font-bold">Documents</h1>

      <Card>
        <CardHeader>
          <CardTitle>Upload Document</CardTitle>
        </CardHeader>
        <CardContent>
          <UploadZone />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Document List</CardTitle>
        </CardHeader>
        <CardContent>
          {isLoading ? <Skeleton /> :
           documents.length === 0 ? <EmptyState /> :
           <DocumentTable documents={documents} />}
        </CardContent>
      </Card>
    </div>
    ```

    When upload succeeds, the useDocuments query should automatically refresh
    (due to invalidation in useUploadDocument onSuccess).
  </action>
  <verify>
    Run `npm run dev`, navigate to http://localhost:3000/documents:
    - Page renders with upload zone and document list sections
    - Drag a file over upload zone - should highlight
    - If backend is running, upload should work and list should refresh
  </verify>
  <done>Documents page shows upload zone and document list, upload triggers list refresh</done>
</task>

</tasks>

<verification>
1. Navigate to /documents - page renders without errors
2. Drag-and-drop zone visible with correct styling
3. Dragging file over zone shows visual feedback
4. Document table displays with correct columns
5. Status badge shows appropriate colors for each status
6. TypeScript compiles without errors
</verification>

<success_criteria>
- /documents route renders with upload zone and document list
- Drag-and-drop upload accepts PDF, DOCX, PNG, JPG files
- Upload shows loading state during upload
- Document list shows filename, status badge, page count
- Status badge has distinct colors for pending/completed/failed
- Query invalidation refreshes list after upload
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-dashboard**/05-02-SUMMARY.md`
</output>
