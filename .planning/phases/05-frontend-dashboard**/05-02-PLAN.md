---
phase: 05-frontend-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/hooks/use-documents.ts
  - frontend/src/components/documents/upload-zone.tsx
  - frontend/src/components/documents/status-badge.tsx
  - frontend/src/components/documents/document-table.tsx
  - frontend/src/app/documents/page.tsx
  - frontend/src/app/documents/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag and drop a PDF file onto the upload zone"
    - "Upload zone shows loading state during upload"
    - "Document list shows filename, status badge, and page count"
    - "Status badge reflects document processing status (pending, completed, failed)"
    - "User can click a document row to view document details"
    - "Document detail page shows full document metadata and status"
  artifacts:
    - path: "frontend/src/hooks/use-documents.ts"
      provides: "Document query and mutation hooks"
      exports: ["useUploadDocument", "useDocuments", "useDocumentStatus", "useDocument"]
    - path: "frontend/src/components/documents/upload-zone.tsx"
      provides: "Drag-and-drop file upload component"
      exports: ["UploadZone"]
    - path: "frontend/src/components/documents/document-table.tsx"
      provides: "Document list table with columns"
      exports: ["DocumentTable"]
    - path: "frontend/src/app/documents/page.tsx"
      provides: "Documents page combining upload and list"
      min_lines: 30
    - path: "frontend/src/app/documents/[id]/page.tsx"
      provides: "Document detail page showing full metadata"
      min_lines: 40
  key_links:
    - from: "frontend/src/hooks/use-documents.ts"
      to: "frontend/src/lib/api/documents.ts"
      via: "Import API functions"
      pattern: "import.*from.*api/documents"
    - from: "frontend/src/components/documents/upload-zone.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useUploadDocument hook"
      pattern: "useUploadDocument"
    - from: "frontend/src/app/documents/page.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useDocuments hook for list"
      pattern: "useDocuments"
    - from: "frontend/src/components/documents/document-table.tsx"
      to: "next/link"
      via: "Row click navigation to document detail"
      pattern: "Link.*documents/.*id"
    - from: "frontend/src/app/documents/[id]/page.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useDocument hook for detail"
      pattern: "useDocument"
---

<objective>
Build the document upload and listing feature with drag-and-drop upload, status tracking, and document detail view.

Purpose: Enable users to upload loan documents, see processing status, and view detailed information (Success Criteria #1).
Output: Working /documents page with drag-drop upload zone, document list table, and /documents/[id] detail page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-dashboard**/05-RESEARCH.md
@.planning/phases/05-frontend-dashboard**/05-01-SUMMARY.md

Reference files from Plan 01:
@frontend/src/lib/api/documents.ts (API functions)
@frontend/src/lib/api/types.ts (TypeScript types)
@frontend/src/lib/query-client.ts (QueryClient config)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create document hooks</name>
  <files>frontend/src/hooks/use-documents.ts</files>
  <action>
    Create `hooks/use-documents.ts` (client component patterns):

    1. useUploadDocument():
       - useMutation wrapping uploadDocument API
       - On success: invalidate ["documents"] query
       - Return mutate, isPending, isSuccess, error, data

    2. useDocuments(limit?, offset?):
       - useQuery with queryKey ["documents", limit, offset]
       - Fetch from listDocuments API

    3. useDocumentStatus(documentId: string | null):
       - useQuery with queryKey ["document-status", documentId]
       - enabled: !!documentId
       - refetchInterval: conditional polling
         - Return 2000ms if status is "pending" or "processing"
         - Return false (stop polling) if "completed" or "failed"
       - This implements status polling as per research Pattern 3

    4. useDocument(id: string):
       - useQuery with queryKey ["document", id]
       - Fetch from getDocument API
       - Return typed DocumentResponse

    All hooks should be typed with the types from lib/api/types.ts.
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npx tsc --noEmit` passes.
  </verify>
  <done>Document hooks export useUploadDocument, useDocuments, useDocumentStatus, useDocument</done>
</task>

<task type="auto">
  <name>Task 2: Create document UI components</name>
  <files>
    frontend/src/components/documents/upload-zone.tsx
    frontend/src/components/documents/status-badge.tsx
    frontend/src/components/documents/document-table.tsx
  </files>
  <action>
    Create `components/documents/upload-zone.tsx`:
    - "use client" directive
    - Use react-dropzone useDropzone hook
    - Accept: PDF, DOCX, PNG, JPG (see research Pattern 2 for accept config)
    - maxFiles: 1, disabled when isPending
    - Visual states:
      - Default: dashed border, "Drag and drop a file here, or click to select"
      - Drag active: border-primary, bg-primary/5
      - Uploading: opacity-50, "Uploading..."
      - Success: Show success message with document ID
      - Error: Show error message
    - On drop, call mutate with file[0]
    - Use cn() for conditional classes (from lib/utils)

    Create `components/documents/status-badge.tsx`:
    - Props: status: DocumentStatus
    - Map status to Badge variants:
      - pending: secondary, "Pending"
      - processing: outline, "Processing"
      - completed: default (green-ish), "Completed"
      - failed: destructive, "Failed"
    - Use Badge from shadcn/ui

    Create `components/documents/document-table.tsx`:
    - "use client" directive
    - Props: documents: DocumentResponse[]
    - Use @tanstack/react-table for column definitions
    - Columns:
      - Filename (accessorKey: "filename")
      - Status (custom cell with StatusBadge)
      - Pages (accessorKey: "page_count", show "-" if null)
      - Size (file_size_bytes formatted as KB/MB)
      - Type (file_type)
    - Use Table components from shadcn/ui (Table, TableHeader, TableBody, TableRow, TableHead, TableCell)
    - Add click handler on rows to navigate to /documents/[id] using next/link or useRouter:
      - Wrap each TableRow in a Link component, or
      - Add onClick={() => router.push(`/documents/${document.id}`)} to TableRow
      - Add cursor-pointer class to rows for visual feedback
  </action>
  <verify>
    Components exist and export correctly. TypeScript compiles.
  </verify>
  <done>Upload zone, status badge, and document table components created with row click navigation</done>
</task>

<task type="auto">
  <name>Task 3: Create documents page</name>
  <files>frontend/src/app/documents/page.tsx</files>
  <action>
    Create `app/documents/page.tsx`:
    - "use client" directive (needed for hooks)
    - Import useDocuments and UploadZone, DocumentTable
    - Page structure:
      1. Page header: "Documents" title
      2. Upload section: Card containing UploadZone
      3. Document list section: Card containing DocumentTable
         - Show Skeleton while loading
         - Show "No documents yet" if empty
         - Show DocumentTable when data loaded

    Layout:
    ```
    <div className="p-6 space-y-6">
      <h1 className="text-3xl font-bold">Documents</h1>

      <Card>
        <CardHeader>
          <CardTitle>Upload Document</CardTitle>
        </CardHeader>
        <CardContent>
          <UploadZone />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Document List</CardTitle>
        </CardHeader>
        <CardContent>
          {isLoading ? <Skeleton /> :
           documents.length === 0 ? <EmptyState /> :
           <DocumentTable documents={documents} />}
        </CardContent>
      </Card>
    </div>
    ```

    When upload succeeds, the useDocuments query should automatically refresh
    (due to invalidation in useUploadDocument onSuccess).
  </action>
  <verify>
    Run `npm run dev`, navigate to http://localhost:3000/documents:
    - Page renders with upload zone and document list sections
    - Drag a file over upload zone - should highlight
    - If backend is running, upload should work and list should refresh
  </verify>
  <done>Documents page shows upload zone and document list, upload triggers list refresh</done>
</task>

<task type="auto">
  <name>Task 4: Create document detail page</name>
  <files>frontend/src/app/documents/[id]/page.tsx</files>
  <action>
    Create `app/documents/[id]/page.tsx`:
    - "use client" directive
    - Get id from params (useParams or page props)
    - Use useDocument(id) hook for document data
    - Page structure:
      1. Back button: Link to /documents with arrow icon
      2. Header: Document filename as title + StatusBadge
      3. Main content: Card with document metadata:
         - File Type
         - File Size (formatted as KB/MB)
         - Page Count (or "Unknown" if null)
         - Status with StatusBadge
         - Error Message (if status is "failed")
         - GCS URI (if available, for debugging)
         - Upload Date (formatted with date-fns)
      4. If document is processing, show Progress component or spinner

    Layout:
    ```
    <div className="p-6 space-y-6">
      <div className="flex items-center gap-2">
        <Link href="/documents" className="flex items-center gap-1 text-muted-foreground hover:text-foreground">
          <ArrowLeft className="h-4 w-4" />
          Back to Documents
        </Link>
      </div>

      <div className="flex items-center gap-4">
        <h1 className="text-3xl font-bold">{document.filename}</h1>
        <StatusBadge status={document.status} />
      </div>

      <Card>
        <CardHeader>
          <CardTitle>Document Details</CardTitle>
        </CardHeader>
        <CardContent>
          <dl className="grid grid-cols-2 gap-4">
            <div><dt className="font-medium">File Type</dt><dd>{document.file_type}</dd></div>
            <div><dt className="font-medium">File Size</dt><dd>{formatBytes(document.file_size_bytes)}</dd></div>
            <div><dt className="font-medium">Page Count</dt><dd>{document.page_count ?? "Unknown"}</dd></div>
            {document.error_message && (
              <div className="col-span-2"><dt className="font-medium text-destructive">Error</dt><dd>{document.error_message}</dd></div>
            )}
          </dl>
        </CardContent>
      </Card>
    </div>
    ```

    Loading state: Show Skeleton for entire page
    Error state: Show error message with retry option

    Helper function for formatBytes:
    ```typescript
    function formatBytes(bytes: number): string {
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
    }
    ```
  </action>
  <verify>
    Run `npm run dev`:
    - Navigate to /documents, click a document row
    - Should navigate to /documents/[id]
    - Detail page shows document metadata
    - Back button returns to /documents list
  </verify>
  <done>Document detail page shows full document metadata with back navigation</done>
</task>

</tasks>

<verification>
1. Navigate to /documents - page renders without errors
2. Drag-and-drop zone visible with correct styling
3. Dragging file over zone shows visual feedback
4. Document table displays with correct columns
5. Clicking a document row navigates to /documents/[id]
6. Document detail page shows filename, status, file type, size, page count
7. Back button on detail page returns to /documents
8. Status badge shows appropriate colors for each status
9. TypeScript compiles without errors
</verification>

<success_criteria>
- /documents route renders with upload zone and document list
- Drag-and-drop upload accepts PDF, DOCX, PNG, JPG files
- Upload shows loading state during upload
- Document list shows filename, status badge, page count
- Document table rows are clickable and navigate to /documents/[id]
- /documents/[id] route renders document detail with full metadata
- Status badge has distinct colors for pending/completed/failed
- Query invalidation refreshes list after upload
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-dashboard**/05-02-SUMMARY.md`
</output>
