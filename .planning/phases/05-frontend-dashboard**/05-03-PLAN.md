---
phase: 05-frontend-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/hooks/use-borrowers.ts
  - frontend/src/components/borrowers/borrower-table.tsx
  - frontend/src/components/borrowers/borrower-card.tsx
  - frontend/src/components/borrowers/borrower-search.tsx
  - frontend/src/components/borrowers/income-timeline.tsx
  - frontend/src/components/borrowers/source-references.tsx
  - frontend/src/app/borrowers/page.tsx
  - frontend/src/app/borrowers/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of borrowers with name, confidence, and income count"
    - "User can search borrowers by name (min 2 characters)"
    - "User can click borrower to see detail page"
    - "Borrower detail shows income records sorted by year"
    - "Borrower detail shows source references with document links"
    - "User can navigate between pages of borrowers using pagination controls"
    - "Borrower card displays summary information for individual borrowers"
  artifacts:
    - path: "frontend/src/hooks/use-borrowers.ts"
      provides: "Borrower query hooks"
      exports: ["useBorrowers", "useSearchBorrowers", "useBorrower"]
    - path: "frontend/src/components/borrowers/borrower-table.tsx"
      provides: "Borrower list table with columns"
      exports: ["BorrowerTable"]
    - path: "frontend/src/components/borrowers/borrower-card.tsx"
      provides: "Borrower summary card component"
      exports: ["BorrowerCard"]
    - path: "frontend/src/components/borrowers/income-timeline.tsx"
      provides: "Income history visualization"
      exports: ["IncomeTimeline"]
    - path: "frontend/src/components/borrowers/source-references.tsx"
      provides: "Source document references display"
      exports: ["SourceReferences"]
    - path: "frontend/src/app/borrowers/page.tsx"
      provides: "Borrower list page with search and pagination"
      min_lines: 50
    - path: "frontend/src/app/borrowers/[id]/page.tsx"
      provides: "Borrower detail page"
      min_lines: 50
  key_links:
    - from: "frontend/src/hooks/use-borrowers.ts"
      to: "frontend/src/lib/api/borrowers.ts"
      via: "Import API functions"
      pattern: "import.*from.*api/borrowers"
    - from: "frontend/src/app/borrowers/[id]/page.tsx"
      to: "frontend/src/hooks/use-borrowers.ts"
      via: "useBorrower hook"
      pattern: "useBorrower"
    - from: "frontend/src/components/borrowers/source-references.tsx"
      to: "next/link"
      via: "Link to document pages"
      pattern: "Link.*documents"
---

<objective>
Build the borrower list and detail pages with search, pagination, income timeline, and source references.

Purpose: Enable users to browse and search borrowers, view income history and source attribution (Success Criteria #2, #3).
Output: Working /borrowers list page with pagination and /borrowers/[id] detail page with full data visualization.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-dashboard**/05-RESEARCH.md
@.planning/phases/05-frontend-dashboard**/05-01-SUMMARY.md

Reference files from Plan 01:
@frontend/src/lib/api/borrowers.ts (API functions)
@frontend/src/lib/api/types.ts (TypeScript types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create borrower hooks</name>
  <files>frontend/src/hooks/use-borrowers.ts</files>
  <action>
    Create `hooks/use-borrowers.ts`:

    1. useBorrowers(limit?, offset?):
       - useQuery with queryKey ["borrowers", limit, offset]
       - Fetch from listBorrowers API
       - Return typed BorrowerListResponse

    2. useSearchBorrowers(searchTerm: string):
       - useQuery with queryKey ["borrowers", "search", searchTerm]
       - enabled: searchTerm.length >= 2 (API requires min 2 chars)
       - Fetch from searchBorrowers({ name: searchTerm })
       - Use useDeferredValue pattern for input debouncing at component level

    3. useBorrower(id: string):
       - useQuery with queryKey ["borrower", id]
       - Fetch from getBorrower API
       - Return typed BorrowerDetailResponse

    4. useBorrowerSources(id: string):
       - useQuery with queryKey ["borrower-sources", id]
       - Fetch from getBorrowerSources API
       - Could be combined with useBorrower if sources are included in detail response
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npx tsc --noEmit` passes.
  </verify>
  <done>Borrower hooks export useBorrowers, useSearchBorrowers, useBorrower, useBorrowerSources</done>
</task>

<task type="auto">
  <name>Task 2: Create borrower UI components</name>
  <files>
    frontend/src/components/borrowers/borrower-table.tsx
    frontend/src/components/borrowers/borrower-card.tsx
    frontend/src/components/borrowers/borrower-search.tsx
    frontend/src/components/borrowers/income-timeline.tsx
    frontend/src/components/borrowers/source-references.tsx
  </files>
  <action>
    Create `components/borrowers/borrower-table.tsx`:
    - "use client" directive
    - Props: borrowers: BorrowerSummary[], onRowClick?: (id: string) => void
    - Use @tanstack/react-table
    - Columns:
      - Name (accessorKey: "name")
      - Confidence (custom cell: Badge with color based on score >= 0.7)
      - Income Records (accessorKey: "income_count")
      - Created (accessorKey: "created_at", formatted with date-fns)
    - Row click navigates to /borrowers/[id]

    Create `components/borrowers/borrower-card.tsx`:
    - "use client" directive
    - Props: borrower: BorrowerSummary
    - Display borrower summary in a Card component:
      - Name as CardTitle
      - Confidence score as Badge (green if >= 0.7, yellow if >= 0.5, red otherwise)
      - Income records count
      - Created date (formatted with date-fns)
    - Make entire card clickable, navigates to /borrowers/[id]
    - Use hover effect: hover:shadow-md transition-shadow
    - Compact layout suitable for grid display

    Create `components/borrowers/borrower-search.tsx`:
    - "use client" directive
    - Props: value, onChange, onSearch
    - Input component with search icon (lucide-react Search)
    - Use controlled input with useDeferredValue for performance
    - Minimum 2 characters to trigger search
    - Show loading indicator when searching

    Create `components/borrowers/income-timeline.tsx`:
    - Props: records: IncomeRecord[]
    - Sort records by year descending
    - For each record, show:
      - Year (left side, bold)
      - Amount formatted as currency (right side, bold)
      - Period (e.g., "/monthly", "/annual")
      - Source type and employer (secondary text)
    - Visual timeline with left border connecting entries
    - Use Card wrapper with "Income History" title

    Create `components/borrowers/source-references.tsx`:
    - Props: sources: SourceReference[], borrowerName?: string
    - For each source, show:
      - Document ID (as link to /documents/[document_id])
      - Page number
      - Snippet (truncated with ellipsis if long)
      - Section if present
    - Group by document if multiple references from same doc
    - Use Card wrapper with "Source Documents" title
  </action>
  <verify>
    Components exist and export correctly. TypeScript compiles.
  </verify>
  <done>Borrower table, card, search, income timeline, and source references components created</done>
</task>

<task type="auto">
  <name>Task 3: Create borrower list and detail pages</name>
  <files>
    frontend/src/app/borrowers/page.tsx
    frontend/src/app/borrowers/[id]/page.tsx
  </files>
  <action>
    Create `app/borrowers/page.tsx`:
    - "use client" directive
    - Use useState for:
      - Search mode (list vs search)
      - Pagination state: limit (default 10), offset (default 0)
    - Use useBorrowers(limit, offset) for default list
    - Use useSearchBorrowers when search term present
    - Page structure:
      1. Header: "Borrowers" title
      2. Search input (BorrowerSearch component)
      3. Results: Card containing BorrowerTable
         - Loading: Skeleton
         - Empty: "No borrowers found"
         - Data: BorrowerTable with navigation on row click
      4. Pagination controls at bottom of list:
         - Show "Page X of Y" based on total and limit
         - Previous button: disabled if offset === 0
         - Next button: disabled if offset + limit >= total
         - onClick handlers update offset state
         - Style: flex justify-between items-center with Button components

    Pagination UI example:
    ```tsx
    <div className="flex items-center justify-between pt-4">
      <span className="text-sm text-muted-foreground">
        Page {Math.floor(offset / limit) + 1} of {Math.ceil(total / limit)}
      </span>
      <div className="flex gap-2">
        <Button
          variant="outline"
          size="sm"
          onClick={() => setOffset(Math.max(0, offset - limit))}
          disabled={offset === 0}
        >
          Previous
        </Button>
        <Button
          variant="outline"
          size="sm"
          onClick={() => setOffset(offset + limit)}
          disabled={offset + limit >= total}
        >
          Next
        </Button>
      </div>
    </div>
    ```

    - Use useRouter for navigation to detail page

    Create `app/borrowers/[id]/page.tsx`:
    - "use client" directive
    - Get id from params (useParams or page props)
    - Use useBorrower(id) for detail data
    - Page structure:
      1. Back button: Link to /borrowers
      2. Header: Borrower name + confidence badge
      3. BorrowerCard at top for summary
      4. Two-column layout (on desktop):
         - Left: IncomeTimeline
         - Right: SourceReferences
      5. Account numbers section (if present)
    - Loading state: Skeleton for entire page
    - Error state: Show error message
    - Responsive: Stack columns on mobile (flex-col on mobile, flex-row on lg)

    For address display:
    - address_json is a string, parse it if present
    - Show formatted address or "No address on file"
  </action>
  <verify>
    Run `npm run dev`:
    - /borrowers shows list or "No borrowers" if empty
    - Pagination controls visible at bottom of list
    - Previous/Next buttons navigate between pages
    - Search filters results after 2+ characters
    - Clicking row navigates to /borrowers/[id]
    - Detail page shows BorrowerCard, income timeline and source references
  </verify>
  <done>Borrower list page with pagination and detail page render with search, income timeline, and source references</done>
</task>

</tasks>

<verification>
1. Navigate to /borrowers - page renders with search and list
2. Pagination controls display at bottom: "Page X of Y", Previous, Next buttons
3. Previous button disabled on first page, Next disabled on last page
4. Search with 2+ chars filters results
5. Click borrower row - navigates to detail page
6. Detail page shows borrower name, confidence badge, BorrowerCard summary
7. Income timeline displays records sorted by year (newest first)
8. Source references link to documents
9. Responsive layout works on mobile and desktop
</verification>

<success_criteria>
- /borrowers route shows borrower list with search and pagination
- Pagination controls allow navigating between pages with Previous/Next buttons
- Search requires minimum 2 characters, shows loading state
- Borrower table shows name, confidence badge, income count, date
- BorrowerCard component displays borrower summary with confidence badge
- Row click navigates to /borrowers/[id]
- Detail page shows BorrowerCard, income timeline sorted by year descending
- Detail page shows source references with document links
- Responsive two-column layout on desktop, stacked on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-dashboard**/05-03-SUMMARY.md`
</output>
