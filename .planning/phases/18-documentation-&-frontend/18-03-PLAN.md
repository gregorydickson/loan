---
phase: 18-documentation-frontend
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - frontend/src/components/ui/select.tsx
  - frontend/src/components/documents/upload-zone.tsx
  - frontend/src/hooks/use-documents.ts
  - frontend/src/lib/api/documents.ts
  - frontend/src/lib/api/types.ts

autonomous: false

must_haves:
  truths:
    - "Users can select extraction method (Docling/LangExtract) before uploading"
    - "Users can select OCR mode (auto/force/skip) before uploading"
    - "Selected options are passed to API as query parameters"
    - "Default values match v1.0 behavior (docling, auto)"
  artifacts:
    - path: "frontend/src/components/ui/select.tsx"
      provides: "shadcn Select component"
      contains: "SelectTrigger"
    - path: "frontend/src/components/documents/upload-zone.tsx"
      provides: "Enhanced upload UI with method/OCR selection"
      contains: "setMethod"
    - path: "frontend/src/hooks/use-documents.ts"
      provides: "Extended upload mutation with params"
      contains: "UploadParams"
    - path: "frontend/src/lib/api/documents.ts"
      provides: "API function with query params"
      contains: "queryParams"
  key_links:
    - from: "frontend/src/components/documents/upload-zone.tsx"
      to: "frontend/src/hooks/use-documents.ts"
      via: "useUploadDocument hook"
      pattern: "useUploadDocument"
    - from: "frontend/src/hooks/use-documents.ts"
      to: "frontend/src/lib/api/documents.ts"
      via: "uploadDocumentWithParams function"
      pattern: "uploadDocumentWithParams"
---

<objective>
Add extraction method and OCR mode selection to the frontend upload UI, enabling users to choose between Docling and LangExtract extraction methods and control OCR behavior.

Purpose: Complete the dual pipeline integration by exposing method selection to end users through an intuitive upload interface.
Output: Enhanced UploadZone component with Select dropdowns, extended upload mutation, and updated API client.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/documents/upload-zone.tsx
@frontend/src/hooks/use-documents.ts
@frontend/src/lib/api/documents.ts
@frontend/src/lib/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn Select Component</name>
  <files>frontend/src/components/ui/select.tsx</files>
  <action>
Install the shadcn Select component using the CLI:

```bash
cd frontend && npx shadcn@latest add select --yes
```

This creates frontend/src/components/ui/select.tsx with:
- Select (root component)
- SelectTrigger (clickable button)
- SelectContent (dropdown container)
- SelectItem (individual options)
- SelectValue (displayed value)

The component uses Radix UI primitives and matches existing shadcn/ui styling in the project.

Verify the file is created and contains the expected exports.
  </action>
  <verify>frontend/src/components/ui/select.tsx exists and exports SelectTrigger, SelectContent, SelectItem</verify>
  <done>shadcn Select component installed and available for use</done>
</task>

<task type="auto">
  <name>Task 2: Extend Upload Mutation and API Client</name>
  <files>frontend/src/hooks/use-documents.ts, frontend/src/lib/api/documents.ts, frontend/src/lib/api/types.ts</files>
  <action>
**Update frontend/src/lib/api/types.ts** - Add type definitions:

```typescript
// Add after existing types
export type ExtractionMethod = "docling" | "langextract" | "auto";
export type OCRMode = "auto" | "force" | "skip";

export interface UploadParams {
  file: File;
  method?: ExtractionMethod;
  ocr?: OCRMode;
}
```

**Update frontend/src/lib/api/documents.ts** - Add new upload function:

```typescript
/**
 * Upload a document with extraction method and OCR parameters.
 *
 * @param formData - FormData with file attached
 * @param queryParams - Query string with method and ocr params
 * @returns Upload response with document ID and status
 */
export async function uploadDocumentWithParams(
  formData: FormData,
  queryParams: string
): Promise<DocumentUploadResponse> {
  return apiClient<DocumentUploadResponse>(`/api/documents/?${queryParams}`, {
    method: "POST",
    body: formData,
  });
}
```

**Update frontend/src/hooks/use-documents.ts** - Extend mutation:

```typescript
import {
  uploadDocument,
  uploadDocumentWithParams,
  listDocuments,
  getDocumentStatus,
  getDocument,
} from "@/lib/api/documents";
import type {
  DocumentUploadResponse,
  DocumentResponse,
  DocumentStatusResponse,
  DocumentListResponse,
  UploadParams,
  ExtractionMethod,
  OCRMode,
} from "@/lib/api/types";

/**
 * Hook for uploading documents with extraction method and OCR options.
 *
 * On success, invalidates the documents list query to trigger a refresh.
 */
export function useUploadDocument() {
  const queryClient = useQueryClient();

  return useMutation<DocumentUploadResponse, Error, UploadParams>({
    mutationFn: async ({ file, method = "docling", ocr = "auto" }) => {
      const formData = new FormData();
      formData.append("file", file);
      const params = new URLSearchParams({ method, ocr });
      return uploadDocumentWithParams(formData, params.toString());
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["documents"] });
    },
  });
}
```

Note: The mutation signature changes from `File` to `UploadParams`. This is a breaking change for existing callers - UploadZone will be updated in Task 3.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npm run build`</verify>
  <done>Upload mutation extended to accept method and ocr parameters with defaults matching v1.0 behavior</done>
</task>

<task type="auto">
  <name>Task 3: Add Method/OCR Selection to UploadZone</name>
  <files>frontend/src/components/documents/upload-zone.tsx</files>
  <action>
Update UploadZone component to include extraction method and OCR selection:

```typescript
"use client";

import { useCallback, useState } from "react";
import { useDropzone } from "react-dropzone";
import { Upload, CheckCircle, XCircle, Info } from "lucide-react";
import { cn } from "@/lib/utils";
import { useUploadDocument } from "@/hooks/use-documents";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import type { ExtractionMethod, OCRMode } from "@/lib/api/types";

/**
 * Drag-and-drop file upload component with extraction method and OCR selection.
 *
 * Accepts PDF, DOCX, PNG, and JPG files (max 1 file at a time).
 * Shows loading state during upload and success/error feedback.
 */
export function UploadZone() {
  const { mutate, isPending, isSuccess, error, data, reset } =
    useUploadDocument();
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [method, setMethod] = useState<ExtractionMethod>("docling");
  const [ocr, setOcr] = useState<OCRMode>("auto");

  const onDrop = useCallback(
    (acceptedFiles: File[]) => {
      if (acceptedFiles.length > 0) {
        setSuccessMessage(null);
        mutate(
          { file: acceptedFiles[0], method, ocr },
          {
            onSuccess: (response) => {
              setSuccessMessage(
                `Uploaded: ${response.filename} (ID: ${response.id.slice(0, 8)}...)`
              );
            },
          }
        );
      }
    },
    [mutate, method, ocr]
  );

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      "application/pdf": [".pdf"],
      "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
        [".docx"],
      "image/png": [".png"],
      "image/jpeg": [".jpg", ".jpeg"],
    },
    maxFiles: 1,
    disabled: isPending,
  });

  const handleReset = () => {
    reset();
    setSuccessMessage(null);
  };

  return (
    <div className="space-y-4">
      {/* Extraction Options */}
      <div className="flex flex-wrap gap-4">
        <div className="flex flex-col gap-1.5">
          <label className="text-sm font-medium text-muted-foreground">
            Extraction Method
          </label>
          <Select
            value={method}
            onValueChange={(value) => setMethod(value as ExtractionMethod)}
            disabled={isPending}
          >
            <SelectTrigger className="w-[180px]">
              <SelectValue placeholder="Select method" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="docling">Docling (Fast)</SelectItem>
              <SelectItem value="langextract">LangExtract (Precise)</SelectItem>
              <SelectItem value="auto">Auto</SelectItem>
            </SelectContent>
          </Select>
        </div>

        <div className="flex flex-col gap-1.5">
          <label className="text-sm font-medium text-muted-foreground">
            OCR Mode
          </label>
          <Select
            value={ocr}
            onValueChange={(value) => setOcr(value as OCRMode)}
            disabled={isPending}
          >
            <SelectTrigger className="w-[150px]">
              <SelectValue placeholder="Select OCR" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="auto">Auto Detect</SelectItem>
              <SelectItem value="force">Force OCR</SelectItem>
              <SelectItem value="skip">Skip OCR</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      {/* Method Description */}
      <div className="flex items-start gap-2 text-xs text-muted-foreground bg-muted/50 rounded-md p-2">
        <Info className="h-4 w-4 mt-0.5 shrink-0" />
        <span>
          {method === "docling" && "Fast extraction for standard documents."}
          {method === "langextract" &&
            "Precise extraction with character-level source tracing."}
          {method === "auto" && "System selects best method based on document."}
        </span>
      </div>

      {/* Dropzone */}
      <div
        {...getRootProps()}
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          "hover:border-primary/50 hover:bg-muted/50",
          isDragActive && "border-primary bg-primary/5",
          isPending && "opacity-50 cursor-not-allowed",
          error && "border-destructive"
        )}
      >
        <input {...getInputProps()} />
        <div className="flex flex-col items-center gap-3">
          {isPending ? (
            <>
              <div className="animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full" />
              <p className="text-muted-foreground">Uploading...</p>
            </>
          ) : isDragActive ? (
            <>
              <Upload className="h-8 w-8 text-primary" />
              <p className="text-primary font-medium">Drop the file here...</p>
            </>
          ) : (
            <>
              <Upload className="h-8 w-8 text-muted-foreground" />
              <p className="text-muted-foreground">
                Drag and drop a file here, or click to select
              </p>
              <p className="text-xs text-muted-foreground">
                Accepts PDF, DOCX, PNG, JPG
              </p>
            </>
          )}
        </div>
      </div>

      {/* Success message */}
      {successMessage && (
        <div className="flex items-center gap-2 text-sm text-green-600 dark:text-green-400">
          <CheckCircle className="h-4 w-4" />
          <span>{successMessage}</span>
          <button
            onClick={handleReset}
            className="ml-auto text-muted-foreground hover:text-foreground underline text-xs"
          >
            Upload another
          </button>
        </div>
      )}

      {/* Error message */}
      {error && (
        <div className="flex items-center gap-2 text-sm text-destructive">
          <XCircle className="h-4 w-4" />
          <span>{error.message}</span>
          <button
            onClick={handleReset}
            className="ml-auto text-muted-foreground hover:text-foreground underline text-xs"
          >
            Try again
          </button>
        </div>
      )}
    </div>
  );
}
```

Key changes:
1. Import Select components and types
2. Add state for method and ocr with defaults (docling, auto)
3. Add Select dropdowns above dropzone with labels
4. Add description text that changes based on selected method
5. Pass method and ocr to mutate call
6. Disable selects during pending state
  </action>
  <verify>Frontend builds: `cd frontend && npm run build`. UI shows extraction and OCR dropdowns.</verify>
  <done>DUAL-12 satisfied - frontend supports extraction method selection in upload UI</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Frontend upload UI with extraction method and OCR mode selection dropdowns.
  </what-built>
  <how-to-verify>
1. Start frontend: `cd frontend && npm run dev`
2. Navigate to http://localhost:3000/documents
3. Verify two Select dropdowns appear above the upload dropzone:
   - "Extraction Method" with options: Docling (Fast), LangExtract (Precise), Auto
   - "OCR Mode" with options: Auto Detect, Force OCR, Skip OCR
4. Verify description text updates when method selection changes
5. Select "LangExtract (Precise)" and "Force OCR"
6. Upload a test PDF file
7. Verify upload succeeds (green success message appears)
8. Check browser Network tab: POST request should include ?method=langextract&ocr=force query params
  </how-to-verify>
  <resume-signal>Type "approved" if dropdowns work and query params are passed correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] frontend/src/components/ui/select.tsx exists (shadcn component)
- [ ] frontend/src/lib/api/types.ts contains ExtractionMethod and OCRMode types
- [ ] frontend/src/lib/api/documents.ts contains uploadDocumentWithParams function
- [ ] frontend/src/hooks/use-documents.ts accepts UploadParams with defaults
- [ ] frontend/src/components/documents/upload-zone.tsx has method/ocr Select dropdowns
- [ ] `npm run build` succeeds in frontend directory
- [ ] Upload request includes method and ocr query parameters
</verification>

<success_criteria>
1. shadcn Select component installed and matches project styling
2. Upload mutation accepts method and ocr parameters with sensible defaults
3. UploadZone displays method and OCR selection dropdowns
4. Selected options are passed to API as query parameters
5. Default behavior (docling, auto) matches v1.0 for backward compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/18-documentation-&-frontend/18-03-SUMMARY.md`
</output>
