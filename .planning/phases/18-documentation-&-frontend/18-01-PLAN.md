---
phase: 18-documentation-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/api/extraction-method-guide.md
  - docs/guides/few-shot-examples.md
  - docs/guides/gpu-service-cost.md
  - docs/guides/lightonocr-deployment.md

autonomous: true

must_haves:
  truths:
    - "API users can choose between Docling and LangExtract methods based on documented guidance"
    - "Developers can create few-shot examples following documented patterns with verbatim text requirement"
    - "Operations can manage GPU service costs using documented strategies"
    - "API documentation includes curl examples for method and OCR parameter usage"
  artifacts:
    - path: "docs/api/extraction-method-guide.md"
      provides: "User guide for extraction method selection"
      contains: "?method=langextract"
    - path: "docs/guides/few-shot-examples.md"
      provides: "Guide for creating few-shot examples"
      contains: "extraction_text MUST be exact substring"
    - path: "docs/guides/gpu-service-cost.md"
      provides: "Cost management strategies for GPU service"
      contains: "scale-to-zero"
    - path: "docs/guides/lightonocr-deployment.md"
      provides: "LightOnOCR GPU service deployment guide"
      contains: "L4 GPU"
  key_links:
    - from: "docs/api/extraction-method-guide.md"
      to: "backend API"
      via: "curl examples"
      pattern: "curl.*method=.*ocr="
---

<objective>
Create user-facing documentation guides for the v2.0 dual extraction pipeline, covering extraction method selection, few-shot example creation, GPU service cost management, and LightOnOCR deployment.

Purpose: Enable API users and operators to effectively use and manage the new v2.0 extraction capabilities without requiring deep codebase knowledge.
Output: Four markdown guide files in docs/ directory covering practical usage patterns and operational concerns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/src/api/documents.py
@backend/examples/__init__.py
@docs/cloudbuild-deployment-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Extraction Method Selection Guide</name>
  <files>docs/api/extraction-method-guide.md</files>
  <action>
Create comprehensive guide for API users to select extraction methods:

1. Quick reference table:
   | Method | Best For | Speed | Cost | Accuracy |
   | docling | Standard PDFs, fast processing | Fast | Low | Good |
   | langextract | Complex docs, audit trail needed | Moderate | Medium | Better |
   | auto | Let system decide | Varies | Varies | Optimal |

2. Method parameter usage:
   - Default: ?method=docling (v1.0 compatible)
   - Character offsets: ?method=langextract
   - Auto-detection: ?method=auto

3. OCR mode parameter usage:
   - ?ocr=auto - detect scanned pages, OCR only if needed
   - ?ocr=force - always run OCR (for poor quality scans)
   - ?ocr=skip - never OCR (native text PDFs only)

4. Curl examples for each combination:
   ```bash
   # Default Docling extraction
   curl -X POST "http://localhost:8000/api/documents/" -F "file=@loan.pdf"

   # LangExtract with character offsets
   curl -X POST "http://localhost:8000/api/documents/?method=langextract" -F "file=@loan.pdf"

   # LangExtract with forced OCR for scanned documents
   curl -X POST "http://localhost:8000/api/documents/?method=langextract&ocr=force" -F "file=@scan.pdf"

   # Skip OCR for native digital PDFs
   curl -X POST "http://localhost:8000/api/documents/?method=docling&ocr=skip" -F "file=@digital.pdf"
   ```

5. Response differences section explaining character offset fields in LangExtract responses

6. When to use which section with decision flowchart in text:
   - Need audit trail? -> langextract
   - Processing many simple docs? -> docling
   - Scanned document? -> add &ocr=auto or &ocr=force
  </action>
  <verify>File exists at docs/api/extraction-method-guide.md with curl examples containing method and ocr parameters</verify>
  <done>DOCS-01, DOCS-08, DUAL-10 satisfied - guide contains method selection guidance, API parameter documentation, and practical examples</done>
</task>

<task type="auto">
  <name>Task 2: Create Few-Shot Example Guide</name>
  <files>docs/guides/few-shot-examples.md</files>
  <action>
Create guide for creating and maintaining few-shot examples:

1. Overview:
   - What are few-shot examples (prompt engineering for extraction)
   - Why they matter (LangExtract uses them for domain adaptation)
   - Location: backend/examples/

2. Example structure (from langextract.data):
   ```python
   from langextract.data import ExampleData, Extraction

   example = ExampleData(
       text="... document text ...",
       extractions=[
           Extraction(
               extraction_text="John Smith",  # MUST be exact substring of text
               extraction_type="borrower_name",
               comment="Primary borrower from loan application"
           )
       ]
   )
   ```

3. CRITICAL: Verbatim text requirement (LXTR-05):
   - extraction_text MUST be an exact substring of the text field
   - validate_examples() will fail if not exact match
   - No paraphrasing, no normalization, copy exactly from document

4. Loan document entity types:
   - borrower_name
   - ssn (format: XXX-XX-XXXX as appears in doc)
   - income_amount
   - employer_name
   - account_number
   - property_address

5. Creating new examples workflow:
   a. Identify representative loan document
   b. Extract relevant text section
   c. Mark extraction spans with exact text
   d. Run validate_examples() to verify
   e. Commit with descriptive message

6. Versioning strategy:
   - Examples are version-controlled in git
   - Use commit hashes for traceability
   - Tag major example set changes

7. Validation command:
   ```bash
   cd backend && python -c "from examples import validate_examples; validate_examples()"
   ```
  </action>
  <verify>File exists at docs/guides/few-shot-examples.md containing "extraction_text MUST be exact substring"</verify>
  <done>DOCS-02, DOCS-11 satisfied - guide explains few-shot creation with loan patterns and versioning procedures</done>
</task>

<task type="auto">
  <name>Task 3: Create GPU Service Cost and Deployment Guides</name>
  <files>docs/guides/gpu-service-cost.md, docs/guides/lightonocr-deployment.md</files>
  <action>
Create two operational guides for LightOnOCR GPU service:

**docs/guides/gpu-service-cost.md** (DOCS-10):

1. Cost overview:
   - L4 GPU: ~$0.50/hour when running
   - Scale-to-zero: $0 when idle (min_instances=0)
   - Cold start: ~60-120 seconds

2. Cost optimization strategies:
   - Batch documents during active periods
   - Use ocr=skip for native PDFs (no GPU cost)
   - Monitor with Cloud Monitoring dashboards

3. Cost estimation:
   - Per-document: ~$0.01-0.02 (assuming 1-2 min processing)
   - Monthly (100 docs): ~$1-2
   - Monthly (1000 docs): ~$10-20

4. Monitoring setup:
   - Cloud Run metrics: instance count, request latency
   - Alert on sustained running instances
   - Budget alerts for GPU spend

**docs/guides/lightonocr-deployment.md** (DOCS-05):

1. Prerequisites:
   - L4 GPU quota in target region
   - Service account with Cloud Run permissions
   - Artifact Registry repository

2. Deployment steps:
   ```bash
   # Build GPU image
   gcloud builds submit --config=gpu-cloudbuild.yaml

   # Verify deployment
   gcloud run services describe lightonocr-service --region=us-central1
   ```

3. Configuration reference:
   - vCPU: 8
   - Memory: 32Gi
   - GPU: nvidia-l4 (1)
   - Min instances: 0 (scale to zero)
   - Startup probe: 240s timeout

4. Troubleshooting:
   - Cold start timeouts: Increase client timeout
   - OOM errors: Reduce max_seqs in vLLM config
   - Model loading failures: Check Artifact Registry permissions
  </action>
  <verify>Both files exist with cost management strategies and L4 GPU deployment information</verify>
  <done>DOCS-05, DOCS-10 satisfied - LightOnOCR deployment documented with step-by-step instructions and cost management guide created</done>
</task>

</tasks>

<verification>
- [ ] docs/api/extraction-method-guide.md exists with method/ocr parameter documentation
- [ ] docs/guides/few-shot-examples.md exists with verbatim text requirement
- [ ] docs/guides/gpu-service-cost.md exists with scale-to-zero cost strategies
- [ ] docs/guides/lightonocr-deployment.md exists with L4 GPU deployment steps
- [ ] All guides follow markdown format consistent with existing docs/
</verification>

<success_criteria>
1. API users have clear guidance on choosing between Docling and LangExtract
2. Developers can create valid few-shot examples following documented patterns
3. Operations can estimate and manage GPU service costs
4. LightOnOCR deployment is documented with prerequisites and troubleshooting
</success_criteria>

<output>
After completion, create `.planning/phases/18-documentation-&-frontend/18-01-SUMMARY.md`
</output>
